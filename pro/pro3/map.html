<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –∑–∞–ø–∏—Å–æ–∫ | Everest Me</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Leaflet –¥–ª—è –∫–∞—Ä—Ç—ã -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1 { margin-bottom: 10px; color: #2c3e50; }
        .subtitle { margin-bottom: 20px; color: #7f8c8d; }
        #map { height: 600px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); margin-bottom: 20px; }
        .instructions, .note { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .note { border-left: 4px solid #3498db; }
        code { background: #eee; padding: 2px 5px; border-radius: 3px; }
        .marker-cluster { background-color: rgba(231, 76, 60, 0.6); border-radius: 50%; color: white; text-align: center; font-weight: bold; }
        .marker-cluster div { background-color: rgba(192, 57, 43, 0.9); }
    </style>
</head>
<body>
    <div class="container">
        <h1>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –∑–∞–ø–∏—Å–æ–∫ Everest Me</h1>
        <p class="subtitle">–ú–µ—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–µ—Ç–∏–ª–∏ –ø—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏, –∏ –∏—Ö –∑–∞–º–µ—Ç–∫–∏.</p>

        <div class="instructions">
            <p><strong>–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:</strong> –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –º–µ—Ç–∫–∞—Ö –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ URL. –í–∞—à –±–æ—Ç –¥–æ–ª–∂–µ–Ω —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –≤–∏–¥–∞:</p>
            <p><code>https://–í–ê–®_–õ–û–ì–ò–ù.github.io/everest-map/map.html?data=[{...–¥–∞–Ω–Ω—ã–µ...}]</code></p>
            <p>–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ—ë –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.</p>
        </div>

        <div id="map"></div>

        <div class="note" id="statusNote">
            –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã –∏ –¥–∞–Ω–Ω—ã—Ö...
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã –≤ —Ü–µ–Ω—Ç—Ä–µ –†–æ—Å—Å–∏–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ)
        const map = L.map('map').setView([55.7558, 37.6176], 5);

        // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–π —Å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–∞–º–∏ OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // –ì—Ä—É–ø–ø–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–¥–±–æ—Ä–∞ –º–∞—Å—à—Ç–∞–±–∞
        const markersLayer = L.layerGroup().addTo(map);

        // –§–£–ù–ö–¶–ò–Ø: –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL
        function getNotesDataFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');

            if (!dataParam) {
                console.warn('–ü–∞—Ä–∞–º–µ—Ç—Ä "data" –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL. –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö.');
                return getExampleData(); // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –±–µ–∑ –±–æ—Ç–∞
            }

            try {
                // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –∏ –ø–∞—Ä—Å–∏–º JSON —Å—Ç—Ä–æ–∫—É –∏–∑ URL
                const decodedData = decodeURIComponent(dataParam);
                return JSON.parse(decodedData);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ URL:', error);
                document.getElementById('statusNote').innerHTML = '<span style="color:#e74c3c;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å—Å—ã–ª–∫–∏.</span>';
                return [];
            }
        }

        // –§–£–ù–ö–¶–ò–Ø: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
        function loadMarkers(notesData) {
            if (!notesData || notesData.length === 0) {
                document.getElementById('statusNote').innerHTML = '–ù–∞ –∫–∞—Ä—Ç–µ –Ω–µ—Ç –º–µ—Ç–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.';
                return;
            }

            // –°–æ–∑–¥–∞–µ–º –∏–∫–æ–Ω–∫—É –¥–ª—è –º–µ—Ç–∫–∏
            const customIcon = L.icon({
                iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34]
            });

            let bounds = []; // –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞

            notesData.forEach(note => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
                if (note.lat && note.lon) {
                    const marker = L.marker([note.lat, note.lon], { icon: customIcon })
                        .addTo(markersLayer)
                        .bindPopup(`
                            <div style="min-width: 200px; font-family: sans-serif;">
                                <strong>üë§ ${note.username || '–ê–Ω–æ–Ω–∏–º'}</strong><br>
                                <small>üìÖ ${note.time || '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'}</small><hr style="margin: 5px 0;">
                                <p>${note.text || '...'}</p>
                                <small style="color: gray;">üìç ${note.lat.toFixed(6)}, ${note.lon.toFixed(6)}</small>
                            </div>
                        `);
                    bounds.push([note.lat, note.lon]);
                }
            });

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–±–∏—Ä–∞–µ–º –º–∞—Å—à—Ç–∞–±, —á—Ç–æ–±—ã –±—ã–ª–∏ –≤–∏–¥–Ω—ã –≤—Å–µ –º–µ—Ç–∫–∏
            if (bounds.length > 0) {
                map.fitBounds(bounds);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            document.getElementById('statusNote').innerHTML = `
                ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ <strong>${notesData.length}</strong> –∑–∞–º–µ—Ç–æ–∫. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∑–Ω–∞—á–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å.
            `;
        }

        // –§–£–ù–ö–¶–ò–Ø: –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä 'data' –Ω–µ –ø–µ—Ä–µ–¥–∞–Ω)
        function getExampleData() {
            return [
                { username: "–ò–≤–∞–Ω_–ü—É—Ç–µ—à–µ—Å—Ç–≤–µ–Ω–Ω–∏–∫", lat: 55.755826, lon: 37.617300, text: "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å! –ù–µ–∑–∞–±—ã–≤–∞–µ–º–æ.", time: "15-04-2024 12:30" },
                { username: "–ê–Ω–Ω–∞_–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å", lat: 59.934280, lon: 30.335099, text: "–≠—Ä–º–∏—Ç–∞–∂ - —Ü–µ–ª—ã–π –º–∏—Ä –∏—Å–∫—É—Å—Å—Ç–≤–∞.", time: "10-04-2024 15:45" },
                { username: "–ú–∞–∫—Å–∏–º_–¢—É—Ä–∏—Å—Ç", lat: 43.585525, lon: 39.723062, text: "–°–æ—á–∏, —Å–æ–ª–Ω–µ—á–Ω—ã–π –¥–µ–Ω—å —É –º–æ—Ä—è.", time: "05-04-2024 11:20" }
            ];
        }

        // –ó–ê–ü–£–°–ö: –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—É
        document.addEventListener('DOMContentLoaded', function() {
            const notesData = getNotesDataFromUrl();
            loadMarkers(notesData);
        });
    </script>
</body>
</html>