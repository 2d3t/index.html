<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –∏ –∑–∞–ø–∏—Å—å –≤–∏–¥–µ–æ</title>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1000px;
            gap: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }

        .video-container {
            flex: 1;
            min-width: 300px;
            position: relative;
            background-color: #000;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        #video {
            width: 100%;
            height: auto;
            display: block;
        }

        .teleprompter-container {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            background-color: #1e1e1e;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .teleprompter-header {
            background-color: #2a2a2a;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-bottom: 1px solid #444;
        }

        #textInput {
            flex: 1;
            background-color: #252525;
            color: white;
            border: none;
            padding: 15px;
            resize: none;
            font-size: 16px;
            line-height: 1.5;
            outline: none;
        }

        #textInput::placeholder {
            color: #888;
        }

        #teleprompterText {
            flex: 1;
            padding: 20px;
            font-size: 24px;
            line-height: 1.6;
            overflow-y: auto;
            background-color: rgba(0, 20, 40, 0.7);
            color: #fff;
            text-align: center;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            padding: 20px;
            background-color: #1a1a1a;
            border-radius: 10px;
            width: 100%;
        }

        button {
            background-color: #3a6df0;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s ease;
            min-width: 140px;
        }

        button:hover {
            background-color: #2a5adf;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #555;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }

        button#startTeleprompterBtn {
            background-color: #28a745;
        }

        button#startTeleprompterBtn:hover {
            background-color: #218838;
        }

        button#stopBtn {
            background-color: #dc3545;
        }

        button#stopBtn:hover {
            background-color: #c82333;
        }

        .teleprompter-controls {
            display: none;
            justify-content: center;
            gap: 15px;
            padding: 15px;
            background-color: #252525;
            border-top: 1px solid #444;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ddd;
        }

        #speedSlider {
            width: 100px;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin-top: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .recording {
            background-color: rgba(220, 53, 69, 0.2);
            color: #ff6b6b;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìπ –í–∏–¥–µ–æ–∑–∞–ø–∏—Å—å —Å —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–æ–º</h1>
            <p>–ó–∞–ø–∏—à–∏—Ç–µ –≤–∏–¥–µ–æ, —á–∏—Ç–∞—è —Ç–µ–∫—Å—Ç —Å —ç–∫—Ä–∞–Ω–∞. –¢–µ–∫—Å—Ç –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –∑–∞–ø–∏—Å—å.</p>
        </div>
        
        <div class="main-content">
            <div class="video-container">
                <video id="video" autoplay muted playsinline></video>
            </div>
            
            <div class="teleprompter-container">
                <div class="teleprompter-header">
                    <span id="teleprompterToggleText">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞</span>
                </div>
                
                <textarea 
                    id="textInput" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ –≤–∏–¥–µ–æ. –ù–∞–ø—Ä–∏–º–µ—Ä: –ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –Ω–æ–≤—ã–π —Ä–æ–ª–∏–∫. –°–µ–≥–æ–¥–Ω—è —è —Ä–∞—Å—Å–∫–∞–∂—É –≤–∞–º –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
                    rows="10"
                ></textarea>
                
                <div id="teleprompterText"></div>
                
                <div class="teleprompter-controls" id="teleprompterControls">
                    <div class="speed-control">
                        <span>–°–∫–æ—Ä–æ—Å—Ç—å:</span>
                        <input type="range" id="speedSlider" min="1" max="20" value="10">
                        <span id="speedValue">10</span>
                    </div>
                    <button id="pauseResumeBtn">–ü–∞—É–∑–∞</button>
                    <button id="resetTeleprompterBtn">–° –Ω–∞—á–∞–ª–∞</button>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="startTeleprompterBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—Ñ–ª–µ—Ä</button>
            <button id="startBtn">–ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å</button>
            <button id="pauseResumeRecordBtn" disabled>–ü–∞—É–∑–∞ –∑–∞–ø–∏—Å–∏</button>
            <button id="stopBtn" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
        </div>
        
        <div id="status" class="status"></div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const videoElement = document.getElementById('video');
        const textInput = document.getElementById('textInput');
        const teleprompterText = document.getElementById('teleprompterText');
        const teleprompterControls = document.getElementById('teleprompterControls');
        const teleprompterToggleText = document.getElementById('teleprompterToggleText');
        
        const startTeleprompterBtn = document.getElementById('startTeleprompterBtn');
        const startBtn = document.getElementById('startBtn');
        const pauseResumeRecordBtn = document.getElementById('pauseResumeRecordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const pauseResumeBtn = document.getElementById('pauseResumeBtn');
        const resetTeleprompterBtn = document.getElementById('resetTeleprompterBtn');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const statusDiv = document.getElementById('status');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let mediaRecorder = null;
        let recordedChunks = [];
        let stream = null;
        let isRecording = false;
        let isPaused = false;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞
        let isTeleprompterActive = false;
        let isTeleprompterPaused = false;
        let teleprompterPosition = 0;
        let teleprompterInterval = null;
        let scrollSpeed = parseInt(speedSlider.value);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏
        speedSlider.addEventListener('input', function() {
            scrollSpeed = parseInt(this.value);
            speedValue.textContent = scrollSpeed;
            
            // –ï—Å–ª–∏ —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω, –æ–±–Ω–æ–≤–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
            if (isTeleprompterActive && !isTeleprompterPaused) {
                clearInterval(teleprompterInterval);
                startTeleprompterScrolling();
            }
        });
        
        // –ó–∞–ø—É—Å–∫ —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞
        startTeleprompterBtn.addEventListener('click', function() {
            const text = textInput.value.trim();
            
            if (!text) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞ –∏ —Å–∫—Ä—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
            teleprompterText.textContent = text;
            textInput.style.display = 'none';
            teleprompterText.style.display = 'block';
            teleprompterControls.style.display = 'flex';
            teleprompterToggleText.textContent = '–¢–µ–∫—Å—Ç –¥–ª—è —á—Ç–µ–Ω–∏—è';
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–∫—Ä—É—Ç–∫—É
            teleprompterPosition = 0;
            isTeleprompterActive = true;
            isTeleprompterPaused = false;
            startTeleprompterScrolling();
            
            // –ú–µ–Ω—è–µ–º –∫–Ω–æ–ø–∫—É
            startTeleprompterBtn.disabled = true;
            startTeleprompterBtn.textContent = '–°—É—Ñ–ª–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω';
            startTeleprompterBtn.style.backgroundColor = '#555';
            
            updateStatus('–¢–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –∑–∞–ø—É—â–µ–Ω. –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∏–Ω–∞—Ç—å –∑–∞–ø–∏—Å—å.', 'info');
        });
        
        // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞
        function startTeleprompterScrolling() {
            clearInterval(teleprompterInterval);
            
            teleprompterInterval = setInterval(() => {
                if (!isTeleprompterPaused) {
                    teleprompterPosition += 1;
                    teleprompterText.scrollTop = teleprompterPosition;
                    
                    // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –∫–æ–Ω–µ—Ü —Ç–µ–∫—Å—Ç–∞
                    if (teleprompterPosition >= teleprompterText.scrollHeight - teleprompterText.clientHeight) {
                        clearInterval(teleprompterInterval);
                        updateStatus('–¢–µ–∫—Å—Ç —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞ –∑–∞–∫–æ–Ω—á–∏–ª—Å—è.', 'info');
                    }
                }
            }, 1000 / scrollSpeed); // –ß–µ–º –≤—ã—à–µ —Å–∫–æ—Ä–æ—Å—Ç—å, —Ç–µ–º —á–∞—â–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ–∑–∏—Ü–∏—è
        }
        
        // –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞
        pauseResumeBtn.addEventListener('click', function() {
            isTeleprompterPaused = !isTeleprompterPaused;
            pauseResumeBtn.textContent = isTeleprompterPaused ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ü–∞—É–∑–∞';
            
            if (!isTeleprompterPaused) {
                startTeleprompterScrolling();
            }
        });
        
        // –°–±—Ä–æ—Å —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä–∞
        resetTeleprompterBtn.addEventListener('click', function() {
            teleprompterPosition = 0;
            teleprompterText.scrollTop = 0;
            isTeleprompterPaused = false;
            pauseResumeBtn.textContent = '–ü–∞—É–∑–∞';
            
            if (isTeleprompterActive) {
                startTeleprompterScrolling();
            }
        });
        
        // –ó–∞–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function initCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ 
                    video: {
                        width: { ideal: 1280 },
                        height: { ideal: 720 },
                        facingMode: 'user'
                    }, 
                    audio: true 
                });
                videoElement.srcObject = stream;
                updateStatus('–ö–∞–º–µ—Ä–∞ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                startBtn.disabled = false;
            } catch (err) {
                updateStatus(`–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ/–º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ${err.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º:', err);
            }
        }
        
        // –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å
        startBtn.addEventListener('click', async function() {
            if (!stream) {
                alert('–°–Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É');
                return;
            }
            
            // –ï—Å–ª–∏ —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
            if (!isTeleprompterActive && textInput.value.trim()) {
                if (confirm('–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∑–∞–ø–∏—Å–∏?')) {
                    startTeleprompterBtn.click();
                }
            }
            
            try {
                const options = { 
                    mimeType: 'video/webm;codecs=vp9,opus',
                    audioBitsPerSecond: 128000,
                    videoBitsPerSecond: 2500000
                };
                
                mediaRecorder = new MediaRecorder(stream, options);
                recordedChunks = [];
                
                mediaRecorder.ondataavailable = (event) => {
                    if (event.data && event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };
                
                mediaRecorder.onstop = () => {
                    downloadVideo();
                };
                
                mediaRecorder.start(1000); // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
                isRecording = true;
                isPaused = false;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                startBtn.disabled = true;
                pauseResumeRecordBtn.disabled = false;
                stopBtn.disabled = false;
                pauseResumeRecordBtn.textContent = '–ü–∞—É–∑–∞ –∑–∞–ø–∏—Å–∏';
                
                updateStatus('–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å –≤–∏–¥–µ–æ...', 'recording');
            } catch (err) {
                updateStatus(`–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å–∏: ${err.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ MediaRecorder:', err);
            }
        });
        
        // –ü–∞—É–∑–∞/–≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
        pauseResumeRecordBtn.addEventListener('click', function() {
            if (!mediaRecorder) return;
            
            if (mediaRecorder.state === 'recording') {
                mediaRecorder.pause();
                isPaused = true;
                pauseResumeRecordBtn.textContent = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∑–∞–ø–∏—Å—å';
                updateStatus('–ó–∞–ø–∏—Å—å –Ω–∞ –ø–∞—É–∑–µ', 'info');
            } else if (mediaRecorder.state === 'paused') {
                mediaRecorder.resume();
                isPaused = false;
                pauseResumeRecordBtn.textContent = '–ü–∞—É–∑–∞ –∑–∞–ø–∏—Å–∏';
                updateStatus('–ò–¥–µ—Ç –∑–∞–ø–∏—Å—å –≤–∏–¥–µ–æ...', 'recording');
            }
        });
        
        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏
        stopBtn.addEventListener('click', function() {
            if (mediaRecorder && mediaRecorder.state !== 'inactive') {
                mediaRecorder.stop();
                isRecording = false;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º UI
                startBtn.disabled = false;
                pauseResumeRecordBtn.disabled = true;
                stopBtn.disabled = true;
                
                updateStatus('–ó–∞–ø–∏—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –Ω–∞—á–Ω–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.', 'success');
            }
        });
        
        // –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ
        function downloadVideo() {
            if (recordedChunks.length === 0) {
                updateStatus('–û—à–∏–±–∫–∞: –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                return;
            }
            
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `teleprompter-video-${new Date().toISOString().slice(0, 10)}.webm`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–ª–µ—Å—É—Ñ–ª–µ—Ä –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
            if (isTeleprompterActive) {
                clearInterval(teleprompterInterval);
                isTeleprompterActive = false;
                startTeleprompterBtn.disabled = false;
                startTeleprompterBtn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—É—Ñ–ª–µ—Ä';
                startTeleprompterBtn.style.backgroundColor = '';
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
        function updateStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = 'status';
            
            switch(type) {
                case 'success':
                    statusDiv.style.backgroundColor = 'rgba(40, 167, 69, 0.2)';
                    statusDiv.style.color = '#4cd964';
                    break;
                case 'error':
                    statusDiv.style.backgroundColor = 'rgba(220, 53, 69, 0.2)';
                    statusDiv.style.color = '#ff6b6b';
                    break;
                case 'recording':
                    statusDiv.classList.add('recording');
                    break;
                case 'info':
                    statusDiv.style.backgroundColor = 'rgba(23, 162, 184, 0.2)';
                    statusDiv.style.color = '#5ac8fa';
                    break;
                default:
                    statusDiv.style.backgroundColor = 'rgba(108, 117, 125, 0.2)';
                    statusDiv.style.color = '#8e8e93';
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('load', initCamera);
        
        // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            if (isTeleprompterActive) {
                clearInterval(teleprompterInterval);
            }
        });
    </script>
</body>
</html>