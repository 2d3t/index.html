<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–º–µ—Å–∏ –≥–∏–ø—Å–∞ –∏ –≤–æ–¥—ã</title>
    <style>
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px;
        background-image: url('https://2d3t.github.io/index.html/images/sky.png');
        background-size: cover;
        background-position: center;
        color: #333;
    }
    .container {
        background: rgba(255, 255, 255, 0.95);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        max-width: 600px;
        width: 100%;
    }
    h1 {
        color: #4CAF50;
        text-align: center;
        margin-bottom: 20px;
    }
    h2 {
        color: #333;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 5px;
        margin-top: 25px;
        margin-bottom: 15px;
    }
    .input-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input, select, button {
        padding: 10px;
        margin: 5px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
        box-sizing: border-box;
    }
    button {
        cursor: pointer;
        background-color: #4CAF50;
        color: white;
        border: none;
        transition: background-color 0.3s;
        margin-top: 10px;
    }
    button:hover {
        background-color: #45a049;
    }
    .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 15px;
    }
    .button-group button {
        flex: 1;
        min-width: 150px;
    }
    .colors-group {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }
    #result {
        margin-top: 20px;
        padding: 15px;
        background: white;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        white-space: pre-wrap;
        font-family: monospace;
        line-height: 1.5;
    }
    .image-section {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 20px;
    }
    #previewImage {
        max-width: 100%;
        max-height: 200px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        cursor: pointer;
        transition: transform 0.3s;
    }
    .enlarged {
        transform: scale(2);
        position: relative;
        z-index: 1000;
    }
    .image-controls {
        margin-top: 10px;
        display: flex;
        gap: 10px;
    }
    .image-controls button {
        width: auto;
        padding: 8px 15px;
    }
    #imageUpload {
        display: none;
    }
    .upload-label {
        background-color: #2196F3;
        color: white;
        padding: 8px 15px;
        border-radius: 5px;
        cursor: pointer;
        display: inline-block;
    }
    .upload-label:hover {
        background-color: #0b7dda;
    }
    canvas {
        display: none;
    }
    .color-result {
        background: #f0f0f0;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        border-left: 4px solid #4CAF50;
    }
    .mixed-section {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 20px 0;
        border: 2px dashed #4CAF50;
    }
    .mixed-controls {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 10px;
    }
    .mixed-control-group {
        display: flex;
        flex-direction: column;
    }
    .mixed-control-group label {
        font-size: 14px;
        margin-bottom: 5px;
    }
    .section-title {
        background-color: #4CAF50;
        color: white;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        font-weight: bold;
        margin: 10px 0;
    }
    .warning {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        color: #856404;
        padding: 10px;
        border-radius: 5px;
        margin: 10px 0;
        font-size: 14px;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="image-section">
            <img id="previewImage" src="https://2d3t.github.io/index.html/images/gips.jpg" 
                 alt="–ì–∏–ø—Å —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –¢–∞–π—Ñ—É–Ω –ú–∞—Å—Ç–µ—Ä 35" 
                 onclick="toggleImageSize(this)">
            <div class="image-controls">
                <label class="upload-label">
                    üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–æ—Ç–æ
                    <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)">
                </label>
                <button onclick="clearUploadedImage()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>

        <h1>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–º–µ—Å–∏ –≥–∏–ø—Å–∞ –∏ –≤–æ–¥—ã</h1>
        
        <div class="input-group">
            <label for="mixtureWeight">–ú–∞—Å—Å–∞ —Å–º–µ—Å–∏ (–≥):</label>
            <input type="number" id="mixtureWeight" placeholder="–í–≤–µ–¥–∏—Ç–µ –º–∞—Å—Å—É —Å–º–µ—Å–∏ –≤ –≥—Ä–∞–º–º–∞—Ö" min="1" />
        </div>
        
        <div class="input-group">
            <label for="formName">–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º—ã:</label>
            <input type="text" id="formName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞–∑–∞, –§–∏–≥—É—Ä–∫–∞ –∏ —Ç.–¥." />
        </div>
        
        <div class="colors-group">
            <label for="colorCount">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤:</label>
            <select id="colorCount" onchange="updateColorCount()">
                <option value="1">1 —Ü–≤–µ—Ç</option>
                <option value="2">2 —Ü–≤–µ—Ç–∞</option>
                <option value="3">3 —Ü–≤–µ—Ç–∞</option>
            </select>
        </div>

        <div class="mixed-section">
            <h2>‚ö° –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç</h2>
            <div class="warning">
                ‚ö†Ô∏è –ü–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ —Å–º–µ—Å–∏ –±—É–¥–µ—Ç —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–∞ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏, 
                –≤—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ - –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –≤–∞–º–∏ –º–µ—Ç–æ–¥—É
            </div>
            <div class="mixed-controls">
                <div class="mixed-control-group">
                    <label for="secondHalfMethod">–ú–µ—Ç–æ–¥ –¥–ª—è –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã:</label>
                    <select id="secondHalfMethod">
                        <option value="palyzh">–° "–ü–∞–ª–∏–∂" (–∂–∏–¥–∫–∏–π)</option>
                        <option value="stakhema">–° "–°—Ç–∞—Ö–µ–º–∞-–ú" (—Å—É—Ö–æ–π)</option>
                    </select>
                </div>
                <button onclick="calculateMixed()" style="grid-column: span 2; background-color: #FF9800;">
                    üé® –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç
                </button>
            </div>
        </div>

        <h2>–û–±—ã—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã</h2>
        <div class="button-group">
            <button onclick="calculateStandard()">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç</button>
            <button onclick="calculatePalyzh()">–° "–ü–∞–ª–∏–∂"</button>
            <button onclick="calculateStakhema()">–° "–°—Ç–∞—Ö–µ–º–∞-–ú"</button>
        </div>
        
        <button onclick="downloadImage()">üì∑ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–∞—Å—á—ë—Ç –∫–∞–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>

        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h2>
        <div id="result"></div>
        
        <canvas id="canvas"></canvas>
    </div>

    <script>
        let lastResult = '';
        let uploadedImage = null;
        let uploadedImageUrl = null;

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImageUrl = e.target.result;
                const preview = document.getElementById('previewImage');
                preview.src = uploadedImageUrl;
                uploadedImage = new Image();
                uploadedImage.src = uploadedImageUrl;
            }
            reader.readAsDataURL(file);
        }

        // –û—á–∏—Å—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function clearUploadedImage() {
            uploadedImage = null;
            uploadedImageUrl = null;
            document.getElementById('previewImage').src = 'https://2d3t.github.io/index.html/images/gips.jpg';
            document.getElementById('imageUpload').value = '';
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function toggleImageSize(img) {
            img.classList.toggle('enlarged');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ü–≤–µ—Ç–æ–≤
        function updateColorCount() {
            console.log('–í—ã–±—Ä–∞–Ω–æ —Ü–≤–µ—Ç–æ–≤:', document.getElementById('colorCount').value);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø–æ —Ü–≤–µ—Ç–∞–º
        function splitByColors(total, colorCount) {
            const perColor = total / colorCount;
            const result = [];
            for (let i = 0; i < colorCount; i++) {
                result.push(perColor);
            }
            return result;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–¥–Ω–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º—É –º–µ—Ç–æ–¥—É
        function calculateHalfStandard(halfWeight) {
            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;
            
            const waterWeight = waterRatio * halfWeight;
            const gypsumWeight = gypsumRatio * halfWeight;
            const extraWaterWeight = waterWeight * 0.1;
            const totalWaterWeight = waterWeight + extraWaterWeight;
            
            return {
                water: totalWaterWeight,
                gypsum: gypsumWeight,
                dye: 0,
                method: '—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π'
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–¥–Ω–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –ø–æ –º–µ—Ç–æ–¥—É "–ü–∞–ª–∏–∂"
        function calculateHalfPalyzh(halfWeight) {
            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;
            
            const waterWeight = waterRatio * halfWeight;
            const gypsumWeight = gypsumRatio * halfWeight;
            const dyeWeight = gypsumWeight * 0.01 * 2; // 2% –æ—Ç –º–∞—Å—Å—ã –≥–∏–ø—Å–∞
            
            return {
                water: waterWeight,
                gypsum: gypsumWeight,
                dye: dyeWeight,
                method: '—Å "–ü–∞–ª–∏–∂"'
            };
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–¥–Ω–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã –ø–æ –º–µ—Ç–æ–¥—É "–°—Ç–∞—Ö–µ–º–∞-–ú"
        function calculateHalfStakhema(halfWeight) {
            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;
            
            const waterWeight = waterRatio * halfWeight * 1.2; // +20% –≤–æ–¥—ã
            const gypsumWeight = gypsumRatio * halfWeight;
            const dyeWeight = gypsumWeight * 0.03; // 3% –æ—Ç –º–∞—Å—Å—ã –≥–∏–ø—Å–∞
            
            return {
                water: waterWeight,
                gypsum: gypsumWeight,
                dye: dyeWeight,
                method: '—Å "–°—Ç–∞—Ö–µ–º–∞-–ú"'
            };
        }

        // –ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–´–ô –†–ê–°–ß–ï–¢
        function calculateMixed() {
            const mixtureWeight = parseFloat(document.getElementById('mixtureWeight').value);
            const formName = document.getElementById('formName').value || '–§–æ—Ä–º–∞';
            const colorCount = parseInt(document.getElementById('colorCount').value);
            const secondMethod = document.getElementById('secondHalfMethod').value;
            
            if (isNaN(mixtureWeight) || mixtureWeight <= 0) {
                document.getElementById('result').innerText = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Å—ã —Å–º–µ—Å–∏.';
                return;
            }

            const halfWeight = mixtureWeight / 2;
            
            // –ü–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ—Ç–æ–¥
            const firstHalf = calculateHalfStandard(halfWeight);
            
            // –í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞ - –≤—ã–±—Ä–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥
            let secondHalf;
            if (secondMethod === 'palyzh') {
                secondHalf = calculateHalfPalyzh(halfWeight);
            } else {
                secondHalf = calculateHalfStakhema(halfWeight);
            }

            // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ü–≤–µ—Ç–∞–º
            const firstWaterPerColor = splitByColors(firstHalf.water, colorCount);
            const firstGypsumPerColor = splitByColors(firstHalf.gypsum, colorCount);
            
            const secondWaterPerColor = splitByColors(secondHalf.water, colorCount);
            const secondGypsumPerColor = splitByColors(secondHalf.gypsum, colorCount);
            const secondDyePerColor = splitByColors(secondHalf.dye, colorCount);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            let resultText = `–ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–´–ô –†–ê–°–ß–ï–¢ –°–ú–ï–°–ò\n`;
            resultText += `============================\n`;
            resultText += `–§–æ—Ä–º–∞: ${formName}\n`;
            resultText += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤: ${colorCount}\n`;
            resultText += `–û–±—â–∞—è –º–∞—Å—Å–∞ —Å–º–µ—Å–∏: ${mixtureWeight.toFixed(2)} –≥\n`;
            resultText += `–ú–∞—Å—Å–∞ –∫–∞–∂–¥–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã: ${halfWeight.toFixed(2)} –≥\n\n`;
            
            resultText += `–ü–ï–†–í–ê–Ø –ü–û–õ–û–í–ò–ù–ê (${firstHalf.method}):\n`;
            resultText += `========================\n`;
            resultText += `–í–æ–¥–∞: ${firstHalf.water.toFixed(2)} –≥\n`;
            resultText += `–ì–∏–ø—Å: ${firstHalf.gypsum.toFixed(2)} –≥\n`;
            
            if (firstHalf.dye > 0) {
                resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å: ${firstHalf.dye.toFixed(2)} –≥\n`;
            }
            
            resultText += `\n–í–¢–û–†–ê–Ø –ü–û–õ–û–í–ò–ù–ê (${secondHalf.method}):\n`;
            resultText += `========================\n`;
            resultText += `–í–æ–¥–∞: ${secondHalf.water.toFixed(2)} –≥\n`;
            resultText += `–ì–∏–ø—Å: ${secondHalf.gypsum.toFixed(2)} –≥\n`;
            
            if (secondHalf.dye > 0) {
                const dyePercent = secondMethod === 'palyzh' ? '2%' : '3%';
                resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å: ${secondHalf.dye.toFixed(2)} –≥ (${dyePercent} –æ—Ç –≥–∏–ø—Å–∞)\n`;
            }
            
            resultText += `\n–ò–¢–û–ì–û–í–´–ï –°–£–ú–ú–´:\n`;
            resultText += `===============\n`;
            resultText += `–û–±—â–∞—è –≤–æ–¥–∞: ${(firstHalf.water + secondHalf.water).toFixed(2)} –≥\n`;
            resultText += `–û–±—â–∏–π –≥–∏–ø—Å: ${(firstHalf.gypsum + secondHalf.gypsum).toFixed(2)} –≥\n`;
            
            if (secondHalf.dye > 0) {
                resultText += `–û–±—â–∏–π –∫—Ä–∞—Å–∏—Ç–µ–ª—å: ${secondHalf.dye.toFixed(2)} –≥\n`;
            }
            
            if (colorCount > 1) {
                resultText += `\n–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –¶–í–ï–¢–ê–ú:\n`;
                resultText += `------------------------\n`;
                
                for (let i = 0; i < colorCount; i++) {
                    resultText += `\n–¶–í–ï–¢ ${i + 1}:\n`;
                    resultText += `–ü–µ—Ä–≤–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞:\n`;
                    resultText += `  –í–æ–¥–∞: ${firstWaterPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `  –ì–∏–ø—Å: ${firstGypsumPerColor[i].toFixed(2)} –≥\n`;
                    
                    resultText += `–í—Ç–æ—Ä–∞—è –ø–æ–ª–æ–≤–∏–Ω–∞:\n`;
                    resultText += `  –í–æ–¥–∞: ${secondWaterPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `  –ì–∏–ø—Å: ${secondGypsumPerColor[i].toFixed(2)} –≥\n`;
                    
                    if (secondDyePerColor[i] > 0) {
                        resultText += `  –ö—Ä–∞—Å–∏—Ç–µ–ª—å: ${secondDyePerColor[i].toFixed(2)} –≥\n`;
                    }
                }
            }

            resultText += `\n* –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Å—á–µ—Ç: 50% —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π + 50% ${secondHalf.method}`;

            lastResult = resultText;
            document.getElementById('result').innerText = resultText;
        }

        // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç
        function calculateStandard() {
            const mixtureWeight = parseFloat(document.getElementById('mixtureWeight').value);
            const formName = document.getElementById('formName').value || '–§–æ—Ä–º–∞';
            const colorCount = parseInt(document.getElementById('colorCount').value);
            
            if (isNaN(mixtureWeight) || mixtureWeight <= 0) {
                document.getElementById('result').innerText = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Å—ã —Å–º–µ—Å–∏.';
                return;
            }

            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;

            const waterWeight = waterRatio * mixtureWeight;
            const gypsumWeight = gypsumRatio * mixtureWeight;
            const extraWaterWeight = waterWeight * 0.1;
            const totalWaterWeight = waterWeight + extraWaterWeight;

            // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ü–≤–µ—Ç–∞–º
            const waterPerColor = splitByColors(totalWaterWeight, colorCount);
            const gypsumPerColor = splitByColors(gypsumWeight, colorCount);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            let resultText = `–†–ê–°–ß–ï–¢ –°–ú–ï–°–ò –î–õ–Ø –ì–ò–ü–°–ê\n`;
            resultText += `========================\n`;
            resultText += `–§–æ—Ä–º–∞: ${formName}\n`;
            resultText += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤: ${colorCount}\n`;
            resultText += `–û–±—â–∞—è –º–∞—Å—Å–∞ —Å–º–µ—Å–∏: ${mixtureWeight.toFixed(2)} –≥\n\n`;
            
            resultText += `–û–ë–©–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:\n`;
            resultText += `–í–æ–¥–∞: ${totalWaterWeight.toFixed(2)} –≥\n`;
            resultText += `–ì–∏–ø—Å: ${gypsumWeight.toFixed(2)} –≥\n\n`;
            
            if (colorCount > 1) {
                resultText += `–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –¶–í–ï–¢–ê–ú:\n`;
                resultText += `------------------------\n`;
                
                for (let i = 0; i < colorCount; i++) {
                    resultText += `\n–¶–í–ï–¢ ${i + 1}:\n`;
                    resultText += `–í–æ–¥–∞: ${waterPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `–ì–∏–ø—Å: ${gypsumPerColor[i].toFixed(2)} –≥\n`;
                }
            }

            resultText += `\n* –†–∞—Å—á–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ 100–º–ª –≤–æ–¥—ã : 150–≥ –≥–∏–ø—Å–∞`;

            lastResult = resultText;
            document.getElementById('result').innerText = resultText;
        }

        // –†–∞—Å—á–µ—Ç –¥–ª—è –∂–∏–¥–∫–æ–≥–æ –∫—Ä–∞—Å–∏—Ç–µ–ª—è "–ü–∞–ª–∏–∂"
        function calculatePalyzh() {
            const mixtureWeight = parseFloat(document.getElementById('mixtureWeight').value);
            const formName = document.getElementById('formName').value || '–§–æ—Ä–º–∞';
            const colorCount = parseInt(document.getElementById('colorCount').value);
            
            if (isNaN(mixtureWeight) || mixtureWeight <= 0) {
                document.getElementById('result').innerText = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Å—ã —Å–º–µ—Å–∏.';
                return;
            }

            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;

            const waterWeight = waterRatio * mixtureWeight;
            const gypsumWeight = gypsumRatio * mixtureWeight;
            const dyeWeight = gypsumWeight * 0.01 * 2; // 2% –æ—Ç –º–∞—Å—Å—ã –≥–∏–ø—Å–∞

            // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ü–≤–µ—Ç–∞–º
            const waterPerColor = splitByColors(waterWeight, colorCount);
            const gypsumPerColor = splitByColors(gypsumWeight, colorCount);
            const dyePerColor = splitByColors(dyeWeight, colorCount);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            let resultText = `–†–ê–°–ß–ï–¢ –° –ö–†–ê–°–ò–¢–ï–õ–ï–ú "–ü–ê–õ–ò–ñ"\n`;
            resultText += `==========================\n`;
            resultText += `–§–æ—Ä–º–∞: ${formName}\n`;
            resultText += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤: ${colorCount}\n`;
            resultText += `–û–±—â–∞—è –º–∞—Å—Å–∞ —Å–º–µ—Å–∏: ${mixtureWeight.toFixed(2)} –≥\n\n`;
            
            resultText += `–û–ë–©–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:\n`;
            resultText += `–í–æ–¥–∞: ${waterWeight.toFixed(2)} –≥\n`;
            resultText += `–ì–∏–ø—Å: ${gypsumWeight.toFixed(2)} –≥\n`;
            resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å "–ü–∞–ª–∏–∂": ${dyeWeight.toFixed(2)} –≥ (2% –æ—Ç –≥–∏–ø—Å–∞)\n\n`;
            
            if (colorCount > 1) {
                resultText += `–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –¶–í–ï–¢–ê–ú:\n`;
                resultText += `------------------------\n`;
                
                for (let i = 0; i < colorCount; i++) {
                    resultText += `\n–¶–í–ï–¢ ${i + 1}:\n`;
                    resultText += `–í–æ–¥–∞: ${waterPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `–ì–∏–ø—Å: ${gypsumPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å: ${dyePerColor[i].toFixed(2)} –≥\n`;
                }
            }

            resultText += `\n* –†–∞—Å—á–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ 100–º–ª –≤–æ–¥—ã : 150–≥ –≥–∏–ø—Å–∞`;

            lastResult = resultText;
            document.getElementById('result').innerText = resultText;
        }

        // –†–∞—Å—á–µ—Ç –¥–ª—è —Å—É—Ö–æ–≥–æ –∫—Ä–∞—Å–∏—Ç–µ–ª—è "–°—Ç–∞—Ö–µ–º–∞-–ú"
        function calculateStakhema() {
            const mixtureWeight = parseFloat(document.getElementById('mixtureWeight').value);
            const formName = document.getElementById('formName').value || '–§–æ—Ä–º–∞';
            const colorCount = parseInt(document.getElementById('colorCount').value);
            
            if (isNaN(mixtureWeight) || mixtureWeight <= 0) {
                document.getElementById('result').innerText = '–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Å—ã —Å–º–µ—Å–∏.';
                return;
            }

            const waterRatio = 100 / 130;
            const gypsumRatio = 150 / 130;

            const waterWeight = waterRatio * mixtureWeight * 1.2;
            const gypsumWeight = gypsumRatio * mixtureWeight;
            const dyeWeight = gypsumWeight * 0.03; // 3% –æ—Ç –º–∞—Å—Å—ã –≥–∏–ø—Å–∞

            // –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ü–≤–µ—Ç–∞–º
            const waterPerColor = splitByColors(waterWeight, colorCount);
            const gypsumPerColor = splitByColors(gypsumWeight, colorCount);
            const dyePerColor = splitByColors(dyeWeight, colorCount);

            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            let resultText = `–†–ê–°–ß–ï–¢ –° –ö–†–ê–°–ò–¢–ï–õ–ï–ú "–°–¢–ê–•–ï–ú–ê-–ú"\n`;
            resultText += `==============================\n`;
            resultText += `–§–æ—Ä–º–∞: ${formName}\n`;
            resultText += `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤: ${colorCount}\n`;
            resultText += `–û–±—â–∞—è –º–∞—Å—Å–∞ —Å–º–µ—Å–∏: ${mixtureWeight.toFixed(2)} –≥\n\n`;
            
            resultText += `–û–ë–©–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´:\n`;
            resultText += `–í–æ–¥–∞: ${waterWeight.toFixed(2)} –≥\n`;
            resultText += `–ì–∏–ø—Å: ${gypsumWeight.toFixed(2)} –≥\n`;
            resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å "–°—Ç–∞—Ö–µ–º–∞-–ú": ${dyeWeight.toFixed(2)} –≥ (3% –æ—Ç –≥–∏–ø—Å–∞)\n\n`;
            
            if (colorCount > 1) {
                resultText += `–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –¶–í–ï–¢–ê–ú:\n`;
                resultText += `------------------------\n`;
                
                for (let i = 0; i < colorCount; i++) {
                    resultText += `\n–¶–í–ï–¢ ${i + 1}:\n`;
                    resultText += `–í–æ–¥–∞: ${waterPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `–ì–∏–ø—Å: ${gypsumPerColor[i].toFixed(2)} –≥\n`;
                    resultText += `–ö—Ä–∞—Å–∏—Ç–µ–ª—å: ${dyePerColor[i].toFixed(2)} –≥\n`;
                }
            }

            resultText += `\n* –†–∞—Å—á–µ—Ç –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ 120–º–ª –≤–æ–¥—ã : 150–≥ –≥–∏–ø—Å–∞`;

            lastResult = resultText;
            document.getElementById('result').innerText = resultText;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
        function downloadImage() {
            if (!lastResult) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ä–∞—Å—á–µ—Ç.');
                return;
            }

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');
            
            // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É —Ö–æ–ª—Å—Ç–∞
            const lines = lastResult.split('\n');
            const baseHeight = 600;
            const extraHeight = Math.max(0, (lines.length - 15) * 25);
            canvas.width = 800;
            canvas.height = baseHeight + extraHeight;
            
            // –û—á–∏—â–∞–µ–º —Ö–æ–ª—Å—Ç –±–µ–ª—ã–º —Ñ–æ–Ω–æ–º
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const imageToDraw = uploadedImage || new Image();
            
            if (!uploadedImage) {
                imageToDraw.src = 'https://2d3t.github.io/index.html/images/gips.jpg';
                imageToDraw.crossOrigin = "anonymous";
            }
            
            imageToDraw.onload = function() {
                // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const imageHeight = 200;
                const imageWidth = Math.min((imageToDraw.width / imageToDraw.height) * imageHeight, canvas.width - 40);
                const imageX = (canvas.width - imageWidth) / 2;
                
                ctx.drawImage(imageToDraw, imageX, 20, imageWidth, imageHeight);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
                ctx.fillStyle = '#4CAF50';
                ctx.fillRect(20, imageHeight + 30, canvas.width - 40, 2);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
                ctx.fillStyle = '#2E7D32';
                ctx.font = 'bold 22px Arial';
                ctx.textAlign = 'center';
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø —Ä–∞—Å—á–µ—Ç–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
                let title = '–†–ê–°–ß–ï–¢ –°–ú–ï–°–ò –î–õ–Ø –ì–ò–ü–°–ê';
                if (lastResult.includes('–ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–´–ô')) {
                    title = '–ö–û–ú–ë–ò–ù–ò–†–û–í–ê–ù–ù–´–ô –†–ê–°–ß–ï–¢';
                    ctx.fillStyle = '#FF9800';
                }
                
                ctx.fillText(title, canvas.width / 2, imageHeight + 70);
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç —Ä–∞—Å—á–µ—Ç–∞
                ctx.fillStyle = 'black';
                ctx.font = '16px Arial';
                ctx.textAlign = 'left';
                
                // –†–∏—Å—É–µ–º —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
                let yPos = imageHeight + 100;
                lines.forEach(line => {
                    if (line.includes('===') || line.includes('---')) {
                        // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
                        ctx.fillStyle = '#4CAF50';
                        ctx.font = '14px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else if (line.includes('–¶–í–ï–¢')) {
                        // –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ü–≤–µ—Ç–æ–≤
                        ctx.fillStyle = '#2196F3';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else if (line.includes('–ü–ï–†–í–ê–Ø –ü–û–õ–û–í–ò–ù–ê')) {
                        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–µ—Ä–≤–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã
                        ctx.fillStyle = '#4CAF50';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else if (line.includes('–í–¢–û–†–ê–Ø –ü–û–õ–û–í–ò–ù–ê')) {
                        // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤—Ç–æ—Ä–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã
                        ctx.fillStyle = '#FF9800';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else if (line.includes('–û–ë–©–ò–ï') || line.includes('–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï') || line.includes('–ò–¢–û–ì–û–í–´–ï')) {
                        // –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏
                        ctx.fillStyle = '#555';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else if (line.includes('–§–æ—Ä–º–∞:') || line.includes('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–≤–µ—Ç–æ–≤:') || line.includes('–û–±—â–∞—è –º–∞—Å—Å–∞:') || line.includes('–ú–∞—Å—Å–∞ –∫–∞–∂–¥–æ–π –ø–æ–ª–æ–≤–∏–Ω—ã:')) {
                        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        ctx.fillStyle = '#333';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText(line, 20, yPos);
                        ctx.font = '16px Arial';
                        ctx.fillStyle = 'black';
                    } else {
                        // –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
                        ctx.fillText(line, 20, yPos);
                    }
                    yPos += 24;
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
                ctx.font = '10px Arial';
                ctx.fillStyle = '#888';
                const now = new Date();
                const dateStr = now.toLocaleDateString('ru-RU') + ' ' + 
                               now.getHours().toString().padStart(2, '0') + ':' + 
                               now.getMinutes().toString().padStart(2, '0');
                ctx.textAlign = 'right';
                ctx.fillText(`–°–æ–∑–¥–∞–Ω–æ: ${dateStr}`, canvas.width - 20, canvas.height - 15);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫
                ctx.font = 'italic 10px Arial';
                ctx.fillStyle = '#CCC';
                ctx.fillText('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–º–µ—Å–∏ –≥–∏–ø—Å–∞ –∏ –≤–æ–¥—ã', canvas.width - 20, canvas.height - 5);
                ctx.textAlign = 'left';
                
                // –°–∫–∞—á–∏–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const link = document.createElement('a');
                link.download = `—Ä–∞—Å—á–µ—Ç_–≥–∏–ø—Å–∞_${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')}_${now.getHours().toString().padStart(2,'0')}-${now.getMinutes().toString().padStart(2,'0')}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            };
            
            // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –≤—ã–∑—ã–≤–∞–µ–º onload —Å—Ä–∞–∑—É
            if (imageToDraw.complete) {
                imageToDraw.onload();
            }
        }
    </script>
</body>
</html>