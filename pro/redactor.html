<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KlikEdit üéÄ</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #6c5ce7;
      --secondary-color: #a29bfe;
      --dark-color: #2d3436;
      --light-color: #f5f6fa;
      --success-color: #00b894;
      --danger-color: #d63031;
      --warning-color: #fdcb6e;
      --border-radius: 12px;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark-color);
      line-height: 1.6;
      min-height: 100vh;
      padding: 0;
    }
    
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 100%;
      overflow: hidden;
    }
    
    .header {
      background: var(--dark-color);
      color: white;
      padding: 15px;
      box-shadow: var(--shadow);
      position: relative;
      z-index: 10;
    }
    
    .header h1 {
      font-size: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header h1 i {
      color: var(--secondary-color);
    }
    
    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      justify-content: space-between;
    }
    
    .toolbar-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .toolbar input, .toolbar button {
      padding: 10px 12px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 0.9rem;
      transition: var(--transition);
    }
    
    .toolbar input {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      width: 100px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .toolbar input::placeholder {
      color: rgba(255, 255, 255, 0.6);
    }
    
    .toolbar button {
      background: var(--primary-color);
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    
    .toolbar button:hover {
      background: var(--secondary-color);
      transform: translateY(-2px);
    }
    
    .toolbar button:active {
      transform: translateY(0);
    }
    
    .toolbar button.copied {
      background: var(--success-color);
    }
    
    .toolbar button.danger {
      background: var(--danger-color);
    }
    
    .toolbar button.warning {
      background: var(--warning-color);
      color: var(--dark-color);
    }
    
    .main-content {
      display: flex;
      flex-direction: column;
      flex: 1;
      overflow: hidden;
      position: relative;
    }
    
    .editor-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      background: white;
      border-radius: var(--border-radius);
      margin: 15px;
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 15px;
      background: var(--light-color);
      border-bottom: 1px solid #e0e0e0;
    }
    
    .editor-header h2 {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--dark-color);
    }
    
    .editor-actions {
      display: flex;
      gap: 10px;
    }
    
    .editor-actions button {
      background: transparent;
      border: none;
      color: var(--primary-color);
      font-size: 1.2rem;
      cursor: pointer;
      transition: var(--transition);
      padding: 5px;
      border-radius: 6px;
    }
    
    .editor-actions button:hover {
      background: rgba(108, 92, 231, 0.1);
    }
    
    .editor {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    
    .line-numbers {
      background: #f8f9fa;
      color: #6c757d;
      padding: 10px 5px;
      text-align: right;
      user-select: none;
      overflow: hidden;
      width: 50px;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
      line-height: 1.5;
      border-right: 1px solid #e9ecef;
    }
    
    .line-numbers div {
      padding: 0 8px;
    }
    
    textarea {
      flex: 1;
      border: none;
      outline: none;
      resize: none;
      padding: 10px;
      font-family: 'Fira Code', monospace;
      font-size: 14px;
      line-height: 1.5;
      overflow: auto;
      background: white;
    }
    
    .active-line {
      background: rgba(108, 92, 231, 0.1);
      color: var(--primary-color);
      font-weight: 500;
    }
    
    .preview {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: white;
      z-index: 5;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    
    .preview.active {
      opacity: 1;
      visibility: visible;
    }
    
    .mobile-menu {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      display: flex;
      justify-content: space-around;
      padding: 12px 15px;
      box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      z-index: 20;
    }
    
    .mobile-menu button {
      background: transparent;
      border: none;
      color: var(--dark-color);
      font-size: 1.5rem;
      cursor: pointer;
      transition: var(--transition);
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 50px;
      height: 50px;
    }
    
    .mobile-menu button.active {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 4px 8px rgba(108, 92, 231, 0.3);
    }
    
    .mobile-menu button:hover {
      background: rgba(108, 92, 231, 0.1);
    }
    
    .search-container {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background: white;
      padding: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 15;
      display: none;
    }
    
    .search-container.active {
      display: block;
    }
    
    .search-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .search-input-group {
      display: flex;
      gap: 10px;
    }
    
    .search-input-group input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #e0e0e0;
      border-radius: var(--border-radius);
      font-size: 1rem;
    }
    
    .search-results {
      margin-top: 10px;
      font-size: 0.9rem;
      color: #6c757d;
    }

    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--success-color);
      color: white;
      padding: 12px 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      z-index: 1000;
      transform: translateX(150%);
      transition: transform 0.3s ease;
    }
    
    .notification.show {
      transform: translateX(0);
    }
    
    @media (max-width: 480px) {
      .toolbar {
        flex-direction: column;
        gap: 10px;
      }
      
      .toolbar-group {
        width: 100%;
        justify-content: space-between;
      }
      
      .toolbar input {
        width: 45%;
      }
      
      .toolbar button {
        flex: 1;
        justify-content: center;
      }
      
      .editor-container {
        margin: 10px;
      }
      
      .notification {
        top: 10px;
        right: 10px;
        left: 10px;
        transform: translateY(-100px);
      }
      
      .notification.show {
        transform: translateY(0);
      }
    }
    
    @media (max-width: 360px) {
      .toolbar button span {
        display: none;
      }
      
      .toolbar button i {
        margin-right: 0;
      }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1><i class="fas fa-code"></i> KlikEdit</h1>
      
      <div class="toolbar">
        <div class="toolbar-group">
          <input type="number" id="lineNumber" min="1" placeholder="–°—Ç—Ä–æ–∫–∞">
          <button onclick="goToLine()"><i class="fas fa-arrow-right"></i> <span>–ü–µ—Ä–µ–π—Ç–∏</span></button>
        </div>
        
        <div class="toolbar-group">
          <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫...">
          <button onclick="toggleSearch()"><i class="fas fa-search"></i> <span>–ù–∞–π—Ç–∏</span></button>
        </div>
        
        <div class="toolbar-group">
          <button id="copyButton" onclick="copyText()"><i class="far fa-copy"></i> <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span></button>
          <button class="danger" onclick="clearAll()"><i class="fas fa-trash"></i> <span>–û—á–∏—Å—Ç–∏—Ç—å</span></button>
        </div>
      </div>
    </div>
    
    <div class="main-content">
      <div class="editor-container">
        <div class="editor-header">
          <h2><i class="fas fa-file-code"></i> –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–¥–∞</h2>
          <div class="editor-actions">
            <button onclick="undo()" title="–û—Ç–º–µ–Ω–∏—Ç—å"><i class="fas fa-undo"></i></button>
            <button onclick="redo()" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"><i class="fas fa-redo"></i></button>
            <button onclick="shareCode()" title="–°–∫–∞—á–∞—Ç—å"><i class="fas fa-download"></i></button>
            <button onclick="pasteFromClipboard()" title="–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞"><i class="fas fa-paste"></i></button>
          </div>
        </div>
        
        <div class="editor">
          <div class="line-numbers" id="lineNumbers"></div>
          <textarea id="codeArea" placeholder="–ù–∞—á–Ω–∏—Ç–µ –ø–∏—Å–∞—Ç—å –∫–æ–¥ –∑–¥–µ—Å—å... –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É '–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞' –∏–ª–∏ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—Å—Ç–∞–≤–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ." oninput="updateLineNumbers()" onscroll="syncScroll()"></textarea>
        </div>
      </div>
      
      <iframe class="preview" id="previewFrame"></iframe>
      
      <div class="search-container" id="searchContainer">
        <div class="search-header">
          <h3>–ü–æ–∏—Å–∫ –≤ –∫–æ–¥–µ</h3>
          <button onclick="toggleSearch()"><i class="fas fa-times"></i></button>
        </div>
        <div class="search-input-group">
          <input type="text" id="searchInputModal" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞...">
          <button onclick="findNext()"><i class="fas fa-arrow-down"></i></button>
          <button onclick="findPrev()"><i class="fas fa-arrow-up"></i></button>
        </div>
        <div class="search-results" id="searchResults"></div>
      </div>
    </div>
    
    <div class="mobile-menu">
      <button id="editorBtn" class="active" onclick="showEditor()"><i class="fas fa-edit"></i></button>
      <button id="previewBtn" onclick="runCode()"><i class="fas fa-eye"></i></button>
      <button onclick="shareCode()"><i class="fas fa-download"></i></button>
      <button onclick="pasteFromClipboard()"><i class="fas fa-paste"></i></button>
      <button onclick="window.location.href='https://2d3t.github.io/index.html/'"><i class="fas fa-home"></i></button>
    </div>

    <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i> –¢–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω!
    </div>
  </div>

  <script>
    const textarea = document.getElementById('codeArea');
    const lineNumbers = document.getElementById('lineNumbers');
    const previewFrame = document.getElementById('previewFrame');
    const copyButton = document.getElementById('copyButton');
    const searchInput = document.getElementById('searchInput');
    const searchInputModal = document.getElementById('searchInputModal');
    const searchContainer = document.getElementById('searchContainer');
    const searchResults = document.getElementById('searchResults');
    const editorBtn = document.getElementById('editorBtn');
    const previewBtn = document.getElementById('previewBtn');
    const notification = document.getElementById('notification');

    let history = [];
    let redoStack = [];
    let searchResultsArray = [];
    let currentResult = -1;
    let lastSearch = "";

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
    async function pasteFromClipboard() {
      try {
        // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞
        const permission = await navigator.permissions.query({ name: 'clipboard-read' });
        
        if (permission.state === 'denied') {
          showNotification('–î–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É –æ–±–º–µ–Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.', 'error');
          return;
        }

        // –ß–∏—Ç–∞–µ–º —Ç–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞
        const text = await navigator.clipboard.readText();
        
        if (text) {
          // –ï—Å–ª–∏ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ —É–∂–µ –µ—Å—Ç—å —Ç–µ–∫—Å—Ç, –¥–æ–±–∞–≤–ª—è–µ–º —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏
          if (textarea.value.trim()) {
            textarea.value += '\n\n' + text;
          } else {
            textarea.value = text;
          }
          
          updateLineNumbers();
          showNotification('–¢–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ –≤—Å—Ç–∞–≤–ª–µ–Ω!');
          
          // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –Ω–∞—á–∞–ª—É –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
          setTimeout(() => {
            textarea.scrollTop = textarea.scrollHeight;
          }, 100);
        } else {
          showNotification('–ë—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞ –ø—É—Å—Ç', 'warning');
        }
      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ –∏–∑ –±—É—Ñ–µ—Ä–∞:', err);
        
        // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤ –∏–ª–∏ –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
        showNotification('–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ –≤—Å—Ç–∞–≤–∫–∏. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é (Ctrl+V).', 'warning');
        textarea.focus();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        setTimeout(() => {
          if (confirm('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Å—Ç–∞–≤–∫–∞ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∞. –•–æ—Ç–∏—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤—Ä—É—á–Ω—É—é?')) {
            textarea.focus();
          }
        }, 500);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    async function autoPasteOnLoad() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø—É—Å—Ç –ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä
      if (!textarea.value.trim()) {
        try {
          const text = await navigator.clipboard.readText();
          if (text && text.length > 10) { // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π
            // –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ö–æ—á–µ—Ç –ª–∏ –æ–Ω –≤—Å—Ç–∞–≤–∏—Ç—å
            setTimeout(() => {
              if (confirm('–û–±–Ω–∞—Ä—É–∂–µ–Ω —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä–µ –æ–±–º–µ–Ω–∞. –•–æ—Ç–∏—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä?')) {
                textarea.value = text;
                updateLineNumbers();
                showNotification('–¢–µ–∫—Å—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞ –æ–±–º–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª–µ–Ω!');
              }
            }, 1000);
          }
        } catch (err) {
          // –ú–æ–ª—á–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤—Å—Ç–∞–≤–∫–µ
          console.log('–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Å—Ç–∞–≤–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å:', err);
        }
      }
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showNotification(message, type = 'success') {
      notification.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i> ${message}`;
      
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ü–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
      notification.style.background = type === 'success' ? 
        'var(--success-color)' : type === 'error' ? 
        'var(--danger-color)' : 'var(--warning-color)';
      
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
    function updateLineNumbers() {
      const lines = textarea.value.split('\n').length;
      const extraLines = Math.ceil(lines * 0.5);
      const totalLines = lines + extraLines;

      lineNumbers.innerHTML = '';
      for (let i = 1; i <= totalLines; i++) {
        const div = document.createElement("div");
        div.textContent = i;
        lineNumbers.appendChild(div);
      }
      highlightActiveLine();
    }

    function syncScroll() {
      lineNumbers.scrollTop = textarea.scrollTop;
    }

    function goToLine() {
      const line = parseInt(document.getElementById('lineNumber').value);
      const lines = textarea.value.split('\n');
      const extraLines = Math.ceil(lines.length * 0.5);
      const totalLines = lines.length + extraLines;

      if (!isNaN(line) && line > 0 && line <= totalLines) {
          const lineHeight = parseFloat(getComputedStyle(textarea).lineHeight);
          const linePos = (line - 1) * lineHeight;
          const visibleHeight = textarea.clientHeight;
          const scrollPos = linePos - visibleHeight / 2 + lineHeight / 2;
          
          textarea.scrollTop = Math.max(0, scrollPos);
          highlightActiveLine(line);
      } else {
          alert("–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏!");
      }
    }

    function highlightActiveLine(line) {
      const lineElements = Array.from(lineNumbers.children);
      lineElements.forEach((el, index) => {
        el.classList.remove('active-line');
        if (line && index === (line - 1)) {
          el.classList.add('active-line');
        }
      });
    }

    function copyText() {
      textarea.select();
      document.execCommand('copy');
      
      copyButton.classList.add('copied');
      copyButton.innerHTML = '<i class="fas fa-check"></i> <span>–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ</span>';
      setTimeout(() => {
        copyButton.classList.remove('copied');
        copyButton.innerHTML = '<i class="far fa-copy"></i> <span>–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</span>';
      }, 2000);
    }

    function clearAll() {
      if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–æ–¥?")) {
        textarea.value = '';
        updateLineNumbers();
      }
    }

    function runCode() {
      const code = textarea.value;
      if (!code.trim()) {
        alert("–†–µ–¥–∞–∫—Ç–æ—Ä –ø—É—Å—Ç! –î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.");
        return;
      }
      
      const blob = new Blob([code], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      previewFrame.src = url;

      previewFrame.classList.add("active");
      document.querySelector('.editor-container').style.display = "none";
      
      editorBtn.classList.remove('active');
      previewBtn.classList.add('active');

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showEditor() {
      previewFrame.classList.remove("active");
      document.querySelector('.editor-container').style.display = "flex";
      
      previewBtn.classList.remove('active');
      editorBtn.classList.add('active');
    }

    function shareCode() {
      const code = textarea.value;
      if (!code.trim()) {
        alert("–†–µ–¥–∞–∫—Ç–æ—Ä –ø—É—Å—Ç! –î–æ–±–∞–≤—å—Ç–µ –∫–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.");
        return;
      }
      
      const blob = new Blob([code], { type: 'text/plain' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'code.html';
      link.click();
    }

    function saveState() {
      history.push(textarea.value);
      redoStack = [];
    }

    function undo() {
      if (history.length > 0) {
        redoStack.push(textarea.value);
        textarea.value = history.pop();
        updateLineNumbers();
      }
    }

    function redo() {
      if (redoStack.length > 0) {
        history.push(textarea.value);
        textarea.value = redoStack.pop();
        updateLineNumbers();
      }
    }

    function toggleSearch() {
      searchContainer.classList.toggle('active');
      if (searchContainer.classList.contains('active')) {
        searchInputModal.focus();
      }
    }

    function findAll(term) {
      searchResultsArray = [];
      currentResult = -1;
      if (!term) return;

      const text = textarea.value;
      let index = text.indexOf(term);
      while (index !== -1) {
        searchResultsArray.push(index);
        index = text.indexOf(term, index + term.length);
      }
      
      if (searchResultsArray.length > 0) {
        searchResults.textContent = `–ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${searchResultsArray.length}`;
      } else {
        searchResults.textContent = "–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ";
      }
    }

    function highlightMatch() {
      if (searchResultsArray.length === 0) return;

      const pos = searchResultsArray[currentResult];
      const term = searchInputModal.value;

      textarea.focus();
      textarea.setSelectionRange(pos, pos + term.length);

      const lineHeight = parseFloat(getComputedStyle(textarea).lineHeight);
      const before = textarea.value.substring(0, pos).split("\n").length;
      const scrollPos = (before - 1) * lineHeight - textarea.clientHeight / 2;
      textarea.scrollTop = Math.max(0, scrollPos);
      
      searchResults.textContent = `–ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π: ${searchResultsArray.length} | –¢–µ–∫—É—â–µ–µ: ${currentResult + 1}`;
    }

    function findNext() {
      const term = searchInputModal.value;
      if (!term) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞");
        return;
      }

      if (term !== lastSearch) {
        findAll(term);
        lastSearch = term;
      }
      if (searchResultsArray.length === 0) {
        alert("–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ");
        return;
      }
      currentResult = (currentResult + 1) % searchResultsArray.length;
      highlightMatch();
    }

    function findPrev() {
      const term = searchInputModal.value;
      if (!term) {
        alert("–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞");
        return;
      }

      if (term !== lastSearch) {
        findAll(term);
        lastSearch = term;
      }
      if (searchResultsArray.length === 0) {
        alert("–°–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ");
        return;
      }
      currentResult = (currentResult - 1 + searchResultsArray.length) % searchResultsArray.length;
      highlightMatch();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    textarea.addEventListener('input', saveState);
    
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        toggleSearch();
      }
    });
    
    searchInputModal.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        findNext();
      }
    });

    document.getElementById('lineNumber').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault();
        goToLine();
      }
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    updateLineNumbers();
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—Å—Ç–∞–≤–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π)
    window.addEventListener('load', function() {
      setTimeout(() => {
        autoPasteOnLoad();
      }, 500);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—É—Å—Ç
    if (!textarea.value.trim()) {
      textarea.value = `<!DOCTYPE html>
<html>
<head>
  <title>–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      color: #333;
    }
  </style>
</head>
<body>
  <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ KlikEdit!</h1>
  <p>–ù–∞—á–Ω–∏—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–æ—Å–º–æ—Ç—Ä" –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.</p>
  <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–í—Å—Ç–∞–≤–∏—Ç—å –∏–∑ –±—É—Ñ–µ—Ä–∞" –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤—Å—Ç–∞–≤–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.</p>
</body>
</html>`;
      updateLineNumbers();
    }
  </script>
</body>
</html>