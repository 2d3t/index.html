<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°—Ç–µ–≥–∞–Ω–æ–≥—Ä–∞—Ñ–∏—è: –§–æ—Ç–æ –≤ —Ç–µ–∫—Å—Ç–µ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        body {
            margin: 0;
            padding: 20px 15px;
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            min-height: 100vh;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 20px;
            overflow: hidden;
        }
        
        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 24px;
            font-size: 1.8rem;
            color: #2c3e50;
        }
        
        .description {
            background-color: #e8f4fc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            font-size: 0.95rem;
            border-left: 4px solid #3498db;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 24px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 14px 10px;
            font-weight: 600;
            font-size: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            color: #7f8c8d;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: #3498db;
            border-bottom: 3px solid #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .input-section, .output-section {
            margin-bottom: 24px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .file-input {
            width: 100%;
            padding: 14px;
            border: 2px dashed #bdc3c7;
            border-radius: 12px;
            background-color: #f8f9fa;
            text-align: center;
            margin-bottom: 16px;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .file-input:hover {
            border-color: #3498db;
        }
        
        .file-input input {
            display: none;
        }
        
        .file-info {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .preview-container {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 250px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none;
        }
        
        .mono-info {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 8px;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 0.95rem;
            resize: vertical;
            background-color: #f8f9fa;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .primary-btn {
            background-color: #3498db;
            color: white;
        }
        
        .primary-btn:hover {
            background-color: #2980b9;
        }
        
        .secondary-btn {
            background-color: #ecf0f1;
            color: #2c3e50;
        }
        
        .secondary-btn:hover {
            background-color: #d5dbdb;
        }
        
        .success-btn {
            background-color: #2ecc71;
            color: white;
        }
        
        .success-btn:hover {
            background-color: #27ae60;
        }
        
        .result-container {
            margin-top: 20px;
            padding: 16px;
            border-radius: 12px;
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            display: none;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .result-content {
            max-height: 200px;
            overflow-y: auto;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 0.9rem;
            padding: 10px;
            background-color: white;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .actions {
            margin-top: 12px;
            display: flex;
            gap: 10px;
        }
        
        .actions button {
            padding: 12px;
            font-size: 0.9rem;
        }
        
        .hint {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-top: 8px;
            text-align: center;
        }
        
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 16px;
            }
            
            h1 {
                font-size: 1.6rem;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ –°–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ç–æ –≤ —Ç–µ–∫—Å—Ç–µ</h1>
        
        <div class="description">
            <p>–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é –≤–Ω—É—Ç—Ä–∏ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ, –æ–Ω–æ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ —á—ë—Ä–Ω–æ-–±–µ–ª—ã–π —Ñ–æ—Ä–º–∞—Ç –∏ —Å–∂–∞—Ç–æ. –ó–∞—Ç–µ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å–æ —Å–∫—Ä—ã—Ç—ã–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ. –î–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" data-tab="hide">–°–ø—Ä—è—Ç–∞—Ç—å —Ñ–æ—Ç–æ</button>
            <button class="tab" data-tab="extract">–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ "–°–ø—Ä—è—Ç–∞—Ç—å —Ñ–æ—Ç–æ" -->
        <div id="hide-tab" class="tab-content active">
            <div class="input-section">
                <label for="photo-input">1. –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ç–æ –¥–ª—è —Å–æ–∫—Ä—ã—Ç–∏—è:</label>
                <div class="file-input" id="photo-dropzone">
                    <input type="file" id="photo-input" accept="image/*">
                    <div>üìÅ –ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª</div>
                    <div style="font-size: 0.85rem; margin-top: 8px; color: #7f8c8d;">PNG, JPG, WEBP (–¥–æ 5 –ú–ë)</div>
                </div>
                <div class="file-info" id="file-info"></div>
                
                <div class="preview-container">
                    <img id="image-preview" class="image-preview" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                    <div class="mono-info" id="mono-info"></div>
                </div>
                
                <label for="cover-text">2. –í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ–∫—Ä—ã—Ç–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                <textarea id="cover-text" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥–µ—Ç —Å–ø—Ä—è—Ç–∞–Ω–æ —Ñ–æ—Ç–æ. –ï—Å–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º, –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω —Å–ª—É—á–∞–π–Ω—ã–π —Ç–µ–∫—Å—Ç."></textarea>
                
                <div class="button-group">
                    <button id="hide-btn" class="primary-btn">–°–ø—Ä—è—Ç–∞—Ç—å —Ñ–æ—Ç–æ –≤ —Ç–µ–∫—Å—Ç</button>
                    <button id="clear-hide-btn" class="secondary-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <div id="hide-result" class="result-container">
                <div class="result-title">–¢–µ–∫—Å—Ç —Å–æ —Å–∫—Ä—ã—Ç—ã–º —Ñ–æ—Ç–æ:</div>
                <div id="hidden-text" class="result-content"></div>
                <div class="actions">
                    <button id="copy-text-btn" class="success-btn">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç</button>
                    <button id="download-text-btn" class="secondary-btn">–°–∫–∞—á–∞—Ç—å –∫–∞–∫ —Ñ–∞–π–ª</button>
                </div>
                <div class="hint">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—é. –î–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–æ—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç –≤–æ –≤–∫–ª–∞–¥–∫—É "–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ".</div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ "–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ" -->
        <div id="extract-tab" class="tab-content">
            <div class="input-section">
                <label for="hidden-text-input">1. –í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ —Å–∫—Ä—ã—Ç—ã–º —Ñ–æ—Ç–æ:</label>
                <textarea id="hidden-text-input" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Ç–µ–∫—Å—Ç, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π —Å–∫—Ä—ã—Ç–æ–µ —Ñ–æ—Ç–æ..."></textarea>
                
                <div class="button-group">
                    <button id="extract-btn" class="primary-btn">–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞</button>
                    <button id="clear-extract-btn" class="secondary-btn">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
            
            <div id="extract-result" class="result-container">
                <div class="result-title">–ò–∑–≤–ª–µ—á—ë–Ω–Ω–æ–µ —Ñ–æ—Ç–æ:</div>
                <div class="preview-container">
                    <img id="extracted-image" class="image-preview" alt="–ò–∑–≤–ª–µ—á—ë–Ω–Ω–æ–µ —Ñ–æ—Ç–æ">
                </div>
                <div class="actions">
                    <button id="download-image-btn" class="success-btn">–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ</button>
                </div>
            </div>
        </div>
        
        <div class="hint">
            üîí –î–∞–Ω–Ω—ã–µ –∫–æ–¥–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –Ω—É–ª–µ–≤—ã—Ö –ø—Ä–æ–±–µ–ª–æ–≤ –∏ –¥—Ä—É–≥–∏—Ö –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤ Unicode. –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∂–∏–º–∞–µ—Ç—Å—è –∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —á—ë—Ä–Ω–æ-–±–µ–ª—ã–π —Ñ–æ—Ä–º–∞—Ç.
        </div>
    </div>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const photoInput = document.getElementById('photo-input');
        const photoDropzone = document.getElementById('photo-dropzone');
        const fileInfo = document.getElementById('file-info');
        const imagePreview = document.getElementById('image-preview');
        const monoInfo = document.getElementById('mono-info');
        const coverText = document.getElementById('cover-text');
        const hideBtn = document.getElementById('hide-btn');
        const clearHideBtn = document.getElementById('clear-hide-btn');
        const hideResult = document.getElementById('hide-result');
        const hiddenText = document.getElementById('hidden-text');
        const copyTextBtn = document.getElementById('copy-text-btn');
        const downloadTextBtn = document.getElementById('download-text-btn');
        const hiddenTextInput = document.getElementById('hidden-text-input');
        const extractBtn = document.getElementById('extract-btn');
        const clearExtractBtn = document.getElementById('clear-extract-btn');
        const extractResult = document.getElementById('extract-result');
        const extractedImage = document.getElementById('extracted-image');
        const downloadImageBtn = document.getElementById('download-image-btn');
        
        // –¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64
        let currentImageBase64 = null;
        let currentImageSize = {width: 0, height: 0};
        
        // –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç
                tabContents.forEach(content => {
                    content.classList.remove('active');
                    if (content.id === `${tabId}-tab`) {
                        content.classList.add('active');
                    }
                });
                
                // –û—á–∏—â–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫
                if (tabId === 'hide') {
                    extractResult.style.display = 'none';
                } else {
                    hideResult.style.display = 'none';
                }
            });
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        photoDropzone.addEventListener('click', () => photoInput.click());
        
        photoDropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            photoDropzone.style.borderColor = '#3498db';
            photoDropzone.style.backgroundColor = '#e3f2fd';
        });
        
        photoDropzone.addEventListener('dragleave', () => {
            photoDropzone.style.borderColor = '#bdc3c7';
            photoDropzone.style.backgroundColor = '#f8f9fa';
        });
        
        photoDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            photoDropzone.style.borderColor = '#bdc3c7';
            photoDropzone.style.backgroundColor = '#f8f9fa';
            
            if (e.dataTransfer.files.length) {
                photoInput.files = e.dataTransfer.files;
                handleImageUpload(e.dataTransfer.files[0]);
            }
        });
        
        photoInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleImageUpload(e.target.files[0]);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function handleImageUpload(file) {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
            if (!file.type.match('image.*')) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG, PNG, GIF –∏ —Ç.–¥.)');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–¥–æ 5 –ú–ë)
            if (file.size > 5 * 1024 * 1024) {
                alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 –ú–ë');
                return;
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∞–π–ª–µ
            fileInfo.textContent = `–§–∞–π–ª: ${file.name} (${formatFileSize(file.size)})`;
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const reader = new FileReader();
            reader.onload = function(e) {
                processImage(e.target.result);
            };
            reader.readAsDataURL(file);
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: —Å–∂–∞—Ç–∏–µ –∏ –º–æ–Ω–æ—Ö—Ä–æ–º
        function processImage(dataUrl) {
            const img = new Image();
            img.onload = function() {
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                const maxSize = 300;
                let width = img.width;
                let height = img.height;
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω–æ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ
                if (width > maxSize || height > maxSize) {
                    if (width > height) {
                        height = Math.round((height * maxSize) / width);
                        width = maxSize;
                    } else {
                        width = Math.round((width * maxSize) / height);
                        height = maxSize;
                    }
                }
                
                currentImageSize = {width, height};
                
                // –°–æ–∑–¥–∞–µ–º canvas –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                
                // –†–∏—Å—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ canvas
                ctx.drawImage(img, 0, 0, width, height);
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–æ–Ω–æ—Ö—Ä–æ–º (—á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ)
                const imageData = ctx.getImageData(0, 0, width, height);
                const data = imageData.data;
                
                for (let i = 0; i < data.length; i += 4) {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ –æ—Ç—Ç–µ–Ω–∫–∏ —Å–µ—Ä–æ–≥–æ
                    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ (–±–µ–∑ –ø–æ–ª—É—Ç–æ–Ω–æ–≤)
                    const bw = avg > 128 ? 255 : 0;
                    
                    data[i] = bw;     // –∫—Ä–∞—Å–Ω—ã–π
                    data[i + 1] = bw; // –∑–µ–ª–µ–Ω—ã–π
                    data[i + 2] = bw; // —Å–∏–Ω–∏–π
                    // –ê–ª—å—Ñ–∞-–∫–∞–Ω–∞–ª –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å (data[i + 3])
                }
                
                ctx.putImageData(imageData, 0, 0);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                currentImageBase64 = canvas.toDataURL('image/png', 0.8);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                imagePreview.src = currentImageBase64;
                imagePreview.style.display = 'block';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–∞–∑–º–µ—Ä–µ
                monoInfo.textContent = `–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∂–∞—Ç–æ –¥–æ ${width}x${height} –ø–∏–∫—Å–µ–ª–µ–π –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ —á–µ—Ä–Ω–æ-–±–µ–ª–æ–µ`;
                monoInfo.style.display = 'block';
                
                // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
                hideBtn.disabled = false;
            };
            
            img.src = dataUrl;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 –ë–∞–π—Ç';
            const k = 1024;
            const sizes = ['–ë–∞–π—Ç', '–ö–ë', '–ú–ë', '–ì–ë'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // –ö–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç —Å –ø–æ–º–æ—â—å—é –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        function encodeImageInText(imageBase64, coverTextContent) {
            // –ü–æ–ª—É—á–∞–µ–º base64 —Å—Ç—Ä–æ–∫—É –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞
            const base64Data = imageBase64.split(',')[1];
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º base64 –≤ –±–∏–Ω–∞—Ä–Ω—É—é —Å—Ç—Ä–æ–∫—É
            const binaryString = atob(base64Data);
            
            // –ö–æ–¥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –±–∞–π—Ç —Å –ø–æ–º–æ—â—å—é –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
            let encodedText = '';
            const zeroWidthSpace = '\u200B'; // –Ω—É–ª–µ–≤–æ–π –ø—Ä–æ–±–µ–ª
            const zeroWidthJoiner = '\u200D'; // –Ω—É–ª–µ–≤–æ–π —Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å
            const zeroWidthNonJoiner = '\u200C'; // –Ω—É–ª–µ–≤–æ–π –Ω–µ—Å–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å
            
            for (let i = 0; i < binaryString.length; i++) {
                const charCode = binaryString.charCodeAt(i);
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –±–∞–π—Ç –≤ 8-–±–∏—Ç–Ω–æ–µ –¥–≤–æ–∏—á–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
                let binary = charCode.toString(2).padStart(8, '0');
                
                // –ö–æ–¥–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –±–∏—Ç —Å –ø–æ–º–æ—â—å—é –Ω–µ–≤–∏–¥–∏–º—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                for (let bit of binary) {
                    if (bit === '0') {
                        encodedText += zeroWidthSpace;
                    } else {
                        encodedText += zeroWidthJoiner;
                    }
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –±–∞–π—Ç–∞–º–∏
                encodedText += zeroWidthNonJoiner;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –¥–∞–Ω–Ω—ã—Ö
            const startMarker = '\u2060'; // –Ω–µ–≤–∏–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª WORD JOINER
            const endMarker = '\u2061'; // –Ω–µ–≤–∏–¥–∏–º—ã–π —Å–∏–º–≤–æ–ª FUNCTION APPLICATION
            
            // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Ç–µ–∫—Å—Ç –¥–ª—è —Å–æ–∫—Ä—ã—Ç–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ
            if (coverTextContent && coverTextContent.trim() !== '') {
                // –í—Å—Ç–∞–≤–ª—è–µ–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ—Ä–µ–¥–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
                const textLength = coverTextContent.length;
                const insertPosition = Math.floor(textLength / 2);
                return coverTextContent.substring(0, insertPosition) + 
                       startMarker + encodedText + endMarker + 
                       coverTextContent.substring(insertPosition);
            } else {
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–ª —Å–≤–æ–π
                const randomText = generateRandomText();
                const insertPosition = Math.floor(randomText.length / 2);
                return randomText.substring(0, insertPosition) + 
                       startMarker + encodedText + endMarker + 
                       randomText.substring(insertPosition);
            }
        }
        
        // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Ç–µ–∫—Å—Ç–∞
        function decodeImageFromText(textWithImage) {
            // –ò—â–µ–º –º–∞—Ä–∫–µ—Ä—ã –Ω–∞—á–∞–ª–∞ –∏ –∫–æ–Ω—Ü–∞ –¥–∞–Ω–Ω—ã—Ö
            const startMarker = '\u2060';
            const endMarker = '\u2061';
            
            const startIndex = textWithImage.indexOf(startMarker);
            const endIndex = textWithImage.indexOf(endMarker);
            
            if (startIndex === -1 || endIndex === -1 || startIndex >= endIndex) {
                throw new Error('–í —Ç–µ–∫—Å—Ç–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ —Å–∫—Ä—ã—Ç–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
            }
            
            // –ò–∑–≤–ª–µ–∫–∞–µ–º –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const encodedData = textWithImage.substring(startIndex + 1, endIndex);
            
            // –ù–µ–≤–∏–¥–∏–º—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
            const zeroWidthSpace = '\u200B';
            const zeroWidthJoiner = '\u200D';
            const zeroWidthNonJoiner = '\u200C';
            
            let binaryString = '';
            let byteBits = '';
            
            for (let char of encodedData) {
                if (char === zeroWidthSpace) {
                    byteBits += '0';
                } else if (char === zeroWidthJoiner) {
                    byteBits += '1';
                } else if (char === zeroWidthNonJoiner) {
                    // –ö–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –±–∏—Ç—ã –≤ —Å–∏–º–≤–æ–ª
                    if (byteBits.length === 8) {
                        const charCode = parseInt(byteBits, 2);
                        binaryString += String.fromCharCode(charCode);
                        byteBits = '';
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–∞–∫–æ–ø–∏–ª–æ—Å—å 8 –±–∏—Ç (–±–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è)
                if (byteBits.length === 8) {
                    const charCode = parseInt(byteBits, 2);
                    binaryString += String.fromCharCode(charCode);
                    byteBits = '';
                }
            }
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –±–∏–Ω–∞—Ä–Ω—É—é —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞—Ç–Ω–æ –≤ base64
            const base64Data = btoa(binaryString);
            return 'data:image/png;base64,' + base64Data;
        }
        
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–ª—è —Å–æ–∫—Ä—ã—Ç–∏—è
        function generateRandomText() {
            const paragraphs = [
                "–°–æ–ª–Ω—Ü–µ —Å–≤–µ—Ç–∏–ª–æ —è—Ä–∫–æ, –æ—Å–≤–µ—Ç–ª—è—è –≤—Å—ë –≤–æ–∫—Ä—É–≥. –ü—Ä–∏—Ä–æ–¥–∞ –ø—Ä–æ–±—É–∂–¥–∞–ª–∞—Å—å –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–π –∑–∏–º—ã, –∏ –ø—Ç–∏—Ü—ã —É–∂–µ –Ω–∞—á–∏–Ω–∞–ª–∏ —Å–≤–æ–∏ —É—Ç—Ä–µ–Ω–Ω–∏–µ –ø–µ—Å–Ω–∏. –í–æ–∑–¥—É—Ö –±—ã–ª —Å–≤–µ–∂ –∏ —á–∏—Å—Ç, –Ω–∞–ø–æ–ª–Ω–µ–Ω –∞—Ä–æ–º–∞—Ç–æ–º –≤–µ—Å–µ–Ω–Ω–∏—Ö —Ü–≤–µ—Ç–æ–≤.",
                "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Ä–∞–∑–≤–∏–≤–∞—é—Ç—Å—è, –º–µ–Ω—è—è –Ω–∞—à—É –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—É—é –∂–∏–∑–Ω—å. –¶–∏—Ñ—Ä–æ–≤—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Å—Ç–∞–ª–∏ –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –æ–±—â–µ—Å—Ç–≤–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è —Å–≤—è–∑—å, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∏ —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è.",
                "–ò—Å–∫—É—Å—Å—Ç–≤–æ –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∞–∂–∞–ª–æ –¥—É—Ö –≤—Ä–µ–º–µ–Ω–∏. –•—É–¥–æ–∂–Ω–∏–∫–∏, –º—É–∑—ã–∫–∞–Ω—Ç—ã –∏ –ø–∏—Å–∞—Ç–µ–ª–∏ —á–µ—Ä–µ–∑ —Å–≤–æ–∏ —Ä–∞–±–æ—Ç—ã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ —ç–º–æ—Ü–∏–∏, –∏–¥–µ–∏ –∏ –º–∏—Ä–æ–≤–æ–∑–∑—Ä–µ–Ω–∏–µ, –≤–ª–∏—è—è –Ω–∞ –∫—É–ª—å—Ç—É—Ä—É –∏ –æ–±—â–µ—Å—Ç–≤–æ.",
                "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è –æ—Ç–∫—Ä—ã–≤–∞—é—Ç –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã –∏ —Ä–∞—Å—à–∏—Ä—è—é—Ç –∫—Ä—É–≥–æ–∑–æ—Ä. –ü–æ—Å–µ—â–∞—è —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞–Ω—ã –∏ –∫—É–ª—å—Ç—É—Ä—ã, –º—ã —É–∑–Ω–∞–µ–º –±–æ–ª—å—à–µ –æ –º–∏—Ä–µ –∏ –æ —Å–µ–±–µ, –æ–±–æ–≥–∞—â–∞—è —Å–≤–æ–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π –æ–ø—ã—Ç.",
                "–ù–∞—É–∫–∞ —Å—Ç—Ä–µ–º–∏—Ç—Å—è —Ä–∞—Å–∫—Ä—ã—Ç—å —Ç–∞–π–Ω—ã –≤—Å–µ–ª–µ–Ω–Ω–æ–π. –û—Ç –º–µ–ª—å—á–∞–π—à–∏—Ö —á–∞—Å—Ç–∏—Ü –¥–æ –æ–≥—Ä–æ–º–Ω—ã—Ö –≥–∞–ª–∞–∫—Ç–∏–∫, –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–∏ –ø—ã—Ç–∞—é—Ç—Å—è –ø–æ–Ω—è—Ç—å –∑–∞–∫–æ–Ω—ã, —É–ø—Ä–∞–≤–ª—è—é—â–∏–µ –ø—Ä–∏—Ä–æ–¥–æ–π –∏ –∫–æ—Å–º–æ—Å–æ–º."
            ];
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–∞–≥—Ä–∞—Ñ
            const randomIndex = Math.floor(Math.random() * paragraphs.length);
            return paragraphs[randomIndex];
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–°–ø—Ä—è—Ç–∞—Ç—å —Ñ–æ—Ç–æ –≤ —Ç–µ–∫—Å—Ç"
        hideBtn.addEventListener('click', () => {
            if (!currentImageBase64) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ');
                return;
            }
            
            try {
                const coverTextContent = coverText.value;
                const textWithHiddenImage = encodeImageInText(currentImageBase64, coverTextContent);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                hiddenText.textContent = textWithHiddenImage;
                hideResult.style.display = 'block';
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                hideResult.scrollIntoView({behavior: 'smooth'});
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ç–æ: ' + error.message);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç"
        copyTextBtn.addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(hiddenText.textContent);
                alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            } catch (err) {
                // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –±—Ä–∞—É–∑–µ—Ä–æ–≤
                const textArea = document.createElement('textarea');
                textArea.value = hiddenText.textContent;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('–¢–µ–∫—Å—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—á–∞—Ç—å –∫–∞–∫ —Ñ–∞–π–ª"
        downloadTextBtn.addEventListener('click', () => {
            const text = hiddenText.textContent;
            const blob = new Blob([text], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = '—Å–∫—Ä—ã—Ç–æ–µ_—Ñ–æ—Ç–æ.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ –∏–∑ —Ç–µ–∫—Å—Ç–∞"
        extractBtn.addEventListener('click', () => {
            const textWithImage = hiddenTextInput.value.trim();
            
            if (!textWithImage) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ —Å–∫—Ä—ã—Ç—ã–º —Ñ–æ—Ç–æ');
                return;
            }
            
            try {
                const imageBase64 = decodeImageFromText(textWithImage);
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                extractedImage.src = imageBase64;
                extractedImage.style.display = 'block';
                extractResult.style.display = 'block';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                extractedImage.dataset.base64 = imageBase64;
                
                // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É
                extractResult.scrollIntoView({behavior: 'smooth'});
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–∏ —Ñ–æ—Ç–æ: ' + error.message);
            }
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–∫–∏ "–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ"
        downloadImageBtn.addEventListener('click', () => {
            const imageBase64 = extractedImage.dataset.base64;
            if (!imageBase64) {
                alert('–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è');
                return;
            }
            
            const a = document.createElement('a');
            a.href = imageBase64;
            a.download = '–∏–∑–≤–ª–µ—á–µ–Ω–Ω–æ–µ_—Ñ–æ—Ç–æ.png';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã "–°–ø—Ä—è—Ç–∞—Ç—å —Ñ–æ—Ç–æ"
        clearHideBtn.addEventListener('click', () => {
            photoInput.value = '';
            fileInfo.textContent = '';
            imagePreview.style.display = 'none';
            monoInfo.style.display = 'none';
            coverText.value = '';
            hideResult.style.display = 'none';
            currentImageBase64 = null;
            hideBtn.disabled = true;
        });
        
        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã "–ò–∑–≤–ª–µ—á—å —Ñ–æ—Ç–æ"
        clearExtractBtn.addEventListener('click', () => {
            hiddenTextInput.value = '';
            extractResult.style.display = 'none';
            extractedImage.style.display = 'none';
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        hideBtn.disabled = true;
    </script>
</body>
</html>