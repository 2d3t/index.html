<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReaCT ¬∑ —Ä–µ–∞–∫—Ü–∏—è —Å–æ —Å—Ç–∞—Ä—Ç–æ–º</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background: linear-gradient(145deg, #0B0F1C 0%, #1A1F33 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            font-family: 'Space Grotesk', sans-serif;
            padding: 1rem;
        }

        h1 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #A7C0FF, #6D8CFF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            text-shadow: 0 0 15px rgba(109, 140, 255, 0.3);
            margin-bottom: 0.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin: 0.5rem 0;
        }

        .primary-btn {
            background: linear-gradient(145deg, #2C3F88, #1D2C62);
            border: 2px solid #7E99F0;
            border-radius: 60px;
            padding: 0.8rem 2rem;
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
            cursor: pointer;
            box-shadow: 0 8px 0 #0F1635, 0 0 20px #4160D0;
            transition: 0.07s linear;
            letter-spacing: 0.5px;
        }

        .primary-btn:active {
            transform: translateY(5px);
            box-shadow: 0 3px 0 #0F1635, 0 0 30px #5270E0;
        }

        .primary-btn:disabled {
            opacity: 0.5;
            transform: translateY(0);
            box-shadow: 0 8px 0 #0F1635;
            pointer-events: none;
        }

        #newGameBtn {
            background: linear-gradient(145deg, #3D2F6B, #251B42);
            border: 2px solid #A079FF;
            box-shadow: 0 8px 0 #1A1235, 0 0 20px #8A6DFF;
        }

        #scoreboard {
            background: rgba(18, 24, 40, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 60px;
            padding: 1rem 2.5rem;
            display: inline-flex;
            gap: 3rem;
            font-size: 1.5rem;
            font-weight: 500;
            color: #E9EDFF;
            box-shadow: 0 20px 35px -8px rgba(0, 0, 0, 0.7), inset 0 1px 1px rgba(255, 255, 255, 0.1);
            margin: 1rem 0 1.5rem 0;
            border-bottom: 2px solid #4A5B9F;
        }

        #scoreboard span {
            font-weight: 700;
            color: white;
            background: linear-gradient(135deg, #FFD966, #FFB347);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-left: 0.5rem;
            font-size: 1.9rem;
        }

        #difficultyIndicator {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 0.3rem 1.2rem;
            font-size: 1.1rem;
            color: #B5C7FF;
            border: 1px solid #4A5B9F;
            margin-left: 1rem;
        }

        #soundToggle {
            background: none;
            border: 2px solid #6D8CFF;
            border-radius: 40px;
            padding: 0.3rem 1rem;
            font-size: 1.2rem;
            color: #A7C0FF;
            cursor: pointer;
            transition: 0.2s;
        }

        #soundToggle:hover {
            background: #6D8CFF33;
            border-color: #A7C0FF;
        }

        #soundToggle.muted {
            opacity: 0.5;
            border-color: #666;
        }

        #game {
            position: relative;
            width: min(1200px, 95vw);
            height: 65vh;
            min-height: 500px;
            background: #121827;
            border-radius: 42px;
            border: 1px solid rgba(90, 130, 255, 0.25);
            box-shadow: 
                inset 0 0 40px rgba(0, 0, 0, 0.8),
                0 25px 40px -10px black,
                0 0 0 1px #2F3B66 inset;
            overflow: hidden;
            transition: box-shadow 0.2s;
            opacity: 0.7;
        }

        #game.active {
            opacity: 1;
            box-shadow: 
                inset 0 0 60px rgba(90, 130, 255, 0.3),
                0 25px 40px -10px black,
                0 0 0 2px #6D8CFF inset;
        }

        .square {
            position: absolute;
            width: 64px;
            height: 64px;
            background: radial-gradient(circle at 30% 30%, #FF8A9F, #E63E6E);
            border-radius: 18px;
            box-shadow: 0 12px 0 #8A1E3F, 0 0 25px #FF4F79, 0 0 5px white;
            border: 2px solid rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: transform 0.07s ease, filter 0.1s;
            animation: pop-in 0.15s cubic-bezier(0.2, 0.9, 0.3, 1.3);
            will-change: transform;
        }

        .square:hover {
            transform: scale(1.08);
            filter: brightness(1.2);
            box-shadow: 0 15px 0 #A12244, 0 0 35px #FF617F;
        }

        .square:active {
            transform: scale(0.9);
            filter: brightness(1.5);
            box-shadow: 0 5px 0 #6A162F, 0 0 45px #FF305B;
        }

        @keyframes pop-in {
            0% { transform: scale(0.2); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .miss-flash {
            animation: field-flash 0.12s;
        }

        @keyframes field-flash {
            0% { background-color: #2F1A2F; }
            100% { background-color: #121827; }
        }

        #result {
            background: rgba(12, 18, 34, 0.9);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid #42548A;
            border-radius: 48px;
            padding: 2.5rem 3rem;
            width: min(500px, 90%);
            margin-top: 2rem;
            text-align: center;
            color: white;
            box-shadow: 0 40px 70px black, 0 0 0 2px #6380E0 inset;
            animation: slide-up 0.4s ease;
        }

        @keyframes slide-up {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        #result h2 {
            font-size: 2.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FFB884, #FF8F5E);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        #result p {
            font-size: 1.4rem;
            background: #1E2642;
            padding: 0.8rem 1.5rem;
            border-radius: 100px;
            margin: 1rem 0;
            border: 1px solid #6779B5;
            display: flex;
            justify-content: space-between;
        }

        #result span {
            color: #FFE791;
            font-weight: 700;
        }

        #playerName {
            background: #0D1225;
            border: 2px solid #3A4C8C;
            border-radius: 60px;
            padding: 1rem 2rem;
            width: 100%;
            font-size: 1.2rem;
            color: white;
            outline: none;
            font-family: 'Space Grotesk', sans-serif;
            margin: 20px 0 15px;
            transition: 0.2s;
        }

        #playerName:focus {
            border-color: #A7C0FF;
            box-shadow: 0 0 20px #4F72E0;
        }

        #saveBtn {
            background: linear-gradient(145deg, #2C3F88, #1D2C62);
            border: none;
            border-radius: 60px;
            padding: 1.2rem 2.5rem;
            font-size: 1.6rem;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            box-shadow: 0 15px 0 #0F1635, 0 5px 30px #4160D0;
            transition: 0.07s linear;
            width: 100%;
            border: 1px solid #7E99F0;
        }

        #saveBtn:active {
            transform: translateY(6px);
            box-shadow: 0 5px 0 #0F1635, 0 10px 30px #5270E0;
        }

        .legend {
            display: flex;
            gap: 2rem;
            color: #96A9E6;
            margin: 1rem 0 0.5rem;
            font-weight: 400;
            background: rgba(0,0,0,0.2);
            padding: 0.5rem 2rem;
            border-radius: 40px;
            backdrop-filter: blur(4px);
            align-items: center;
        }

        @media (max-width: 600px) {
            h1 { font-size: 2.2rem; }
            #scoreboard { gap: 0.8rem; font-size: 1rem; padding: 0.7rem 1rem; }
            #scoreboard span { font-size: 1.4rem; }
            .square { width: 50px; height: 50px; }
        }
    </style>
</head>
<body>

    <div class="header-actions">
        <h1>‚ö° REACT ¬∑ ARENA ‚ö°</h1>
    </div>
    
    <div class="action-buttons">
        <button id="startBtn" class="primary-btn">‚ñ∂ –°–¢–ê–†–¢</button>
        <button id="newGameBtn" class="primary-btn">üîÑ –ù–û–í–ê–Ø –ò–ì–†–ê</button>
    </div>
    
    <div id="scoreboard">
        <div>üéØ –û–ß–ö–ò <span id="score">0</span></div>
        <div>üíî –ü–†–û–ú–ê–•–ò <span id="misses">0</span> / 3</div>
        <div>üî• –£–†–û–í <span id="level">1</span> <span id="difficultyIndicator">üê£ –ª–µ–≥–∫–æ</span></div>
    </div>

    <div id="game"></div>

    <div class="legend">
        <span>üîπ –Ω–∞–∂–º–∏ –°–¢–ê–†–¢ —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å ¬∑ 3 –ø—Ä–æ–º–∞—Ö–∞ = –∫–æ–Ω–µ—Ü üîπ</span>
        <button id="soundToggle">üîä –ó–í–£–ö –í–ö–õ</button>
    </div>

    <div id="result" style="display: none;">
        <h2>GAME OVER</h2>
        <p>üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å <span id="finalLevel">1</span></p>
        <p>‚≠ê –í—Å–µ–≥–æ –æ—á–∫–æ–≤ <span id="finalScore">0</span></p>
        <input type="text" id="playerName" placeholder="–≤–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º" autocomplete="off">
        <button id="saveBtn">üíæ –°–û–•–†–ê–ù–ò–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢</button>
    </div>

    <script>
        (function() {
            // ------ –∏–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ -----
            let score = 0;
            let misses = 0;
            let level = 1;
            let gameActive = false; // –ò–≥—Ä–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞ –¥–æ –Ω–∞–∂–∞—Ç–∏—è –°–¢–ê–†–¢
            let soundEnabled = true;

            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            const gameTime = 10;
            const baseInterval = 1000;
            let interval = baseInterval;
            
            // –ó–≤—É–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            const audioCtx = new AudioContext();
            
            // –§—É–Ω–∫—Ü–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∑–≤—É–∫–∞
            function playSound(type) {
                if (!soundEnabled || audioCtx.state === 'suspended') {
                    audioCtx.resume();
                    return;
                }
                
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                
                switch(type) {
                    case 'click': // –£—Å–ø–µ—à–Ω—ã–π –∫–ª–∏–∫
                        oscillator.frequency.value = 800;
                        gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                        oscillator.start();
                        oscillator.stop(audioCtx.currentTime + 0.1);
                        break;
                        
                    case 'miss': // –ü—Ä–æ–º–∞—Ö (–æ–¥–∏–Ω –ø—Ä–æ–º–∞—Ö)
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.value = 180;
                        gainNode.gain.setValueAtTime(0.12, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                        oscillator.start();
                        oscillator.stop(audioCtx.currentTime + 0.2);
                        break;
                        
                    case 'levelUp': // –ù–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å
                        oscillator.frequency.value = 600;
                        gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                        oscillator.start();
                        oscillator.stop(audioCtx.currentTime + 0.3);
                        
                        setTimeout(() => {
                            if (!soundEnabled) return;
                            const osc2 = audioCtx.createOscillator();
                            const gain2 = audioCtx.createGain();
                            osc2.connect(gain2);
                            gain2.connect(audioCtx.destination);
                            osc2.frequency.value = 800;
                            gain2.gain.setValueAtTime(0.15, audioCtx.currentTime);
                            gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                            osc2.start();
                            osc2.stop(audioCtx.currentTime + 0.2);
                        }, 150);
                        break;
                        
                    case 'gameOver': // –§–∏–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ–∏–≥—Ä—ã—à (3 –ø—Ä–æ–º–∞—Ö–∞)
                        // –ì—Ä—É—Å—Ç–Ω–∞—è —Å–∏—Ä–µ–Ω–∞ –≤–Ω–∏–∑
                        oscillator.type = 'sawtooth';
                        oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.8);
                        gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1);
                        oscillator.start();
                        oscillator.stop(audioCtx.currentTime + 1);
                        
                        // –î–æ–±–∞–≤–∏–º –≤—Ç–æ—Ä–æ–π –≥–æ–ª–æ—Å –¥–ª—è –ø–µ—á–∞–ª–∏
                        setTimeout(() => {
                            if (!soundEnabled) return;
                            const osc2 = audioCtx.createOscillator();
                            const gain2 = audioCtx.createGain();
                            osc2.connect(gain2);
                            gain2.connect(audioCtx.destination);
                            osc2.type = 'sine';
                            osc2.frequency.setValueAtTime(150, audioCtx.currentTime);
                            osc2.frequency.exponentialRampToValueAtTime(80, audioCtx.currentTime + 0.6);
                            gain2.gain.setValueAtTime(0.1, audioCtx.currentTime);
                            gain2.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.7);
                            osc2.start();
                            osc2.stop(audioCtx.currentTime + 0.7);
                        }, 200);
                        break;
                }
            }

            // –§–æ—Ä–º—É–ª–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞
            function calculateIntervalForLevel(level) {
                return Math.max(250, baseInterval / (1 + (level - 1) * 0.25));
            }

            // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
            const gameField = document.getElementById("game");
            const scoreSpan = document.getElementById("score");
            const missesSpan = document.getElementById("misses");
            const levelSpan = document.getElementById("level");
            const difficultyIndicator = document.getElementById("difficultyIndicator");
            const resultDiv = document.getElementById("result");
            const finalLevelSpan = document.getElementById("finalLevel");
            const finalScoreSpan = document.getElementById("finalScore");
            const saveBtn = document.getElementById("saveBtn");
            const playerNameInput = document.getElementById("playerName");
            const startBtn = document.getElementById("startBtn");
            const newGameBtn = document.getElementById("newGameBtn");
            const soundToggle = document.getElementById("soundToggle");

            // –î–ª—è —Ç–∞–π–º–µ—Ä–æ–≤
            let levelTimer = null;
            let spawnInterval = null;

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            function updateDifficultyLabel() {
                if (interval >= 800) {
                    difficultyIndicator.textContent = "üê£ –ª–µ–≥–∫–æ";
                } else if (interval >= 600) {
                    difficultyIndicator.textContent = "‚ö° —Å—Ä–µ–¥–Ω–µ";
                } else if (interval >= 400) {
                    difficultyIndicator.textContent = "üî• –±—ã—Å—Ç—Ä–æ";
                } else {
                    difficultyIndicator.textContent = "üíÄ –±–µ–∑—É–º–∏–µ";
                }
            }

            // –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–º–∞—Ö–∞
            function flashMiss() {
                gameField.classList.add('miss-flash');
                setTimeout(() => gameField.classList.remove('miss-flash'), 120);
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–≥–æ –≤–∏–¥–∞ –ø–æ–ª—è (–∞–∫—Ç–∏–≤–Ω–æ/–Ω–µ–∞–∫—Ç–∏–≤–Ω–æ)
            function updateGameFieldState() {
                if (gameActive) {
                    gameField.classList.add('active');
                } else {
                    gameField.classList.remove('active');
                }
            }

            // ----- —Å–ø–∞–≤–Ω –∫–≤–∞–¥—Ä–∞—Ç–∞ -----
            function spawnSquare() {
                if (!gameActive) return;

                const square = document.createElement("div");
                square.classList.add("square");

                const squareSize = 64;
                const maxX = gameField.clientWidth - squareSize;
                const maxY = gameField.clientHeight - squareSize;

                const left = Math.max(0, Math.min(maxX, Math.random() * maxX));
                const top = Math.max(0, Math.min(maxY, Math.random() * maxY));

                square.style.left = left + "px";
                square.style.top = top + "px";

                square.onclick = (e) => {
                    e.stopPropagation();
                    if (!gameActive || !square.parentNode) return;

                    score++;
                    scoreSpan.textContent = score;
                    playSound('click');
                    square.remove();
                };

                gameField.appendChild(square);

                const missTimeout = setTimeout(() => {
                    if (square.parentNode === gameField) {
                        misses++;
                        missesSpan.textContent = misses;
                        square.remove();
                        flashMiss();
                        
                        // –ó–≤—É–∫ –ø—Ä–æ–º–∞—Ö–∞ (–æ–¥–∏–Ω–æ—á–Ω—ã–π)
                        playSound('miss');

                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –Ω–∞–±—Ä–∞–ª–æ—Å—å –ª–∏ 3 –ø—Ä–æ–º–∞—Ö–∞
                        if (misses >= 3 && gameActive) {
                            endGame();
                        }
                    }
                }, interval);
            }

            // ----- –∑–∞–ø—É—Å–∫ —É—Ä–æ–≤–Ω—è -----
            function startLevel() {
                if (!gameActive) return;

                if (spawnInterval) clearInterval(spawnInterval);
                if (levelTimer) clearTimeout(levelTimer);

                interval = calculateIntervalForLevel(level);
                updateDifficultyLabel();

                spawnInterval = setInterval(() => {
                    if (gameActive) spawnSquare();
                }, interval);

                levelTimer = setTimeout(() => {
                    if (gameActive) nextLevel();
                }, gameTime * 1000);
            }

            // ----- –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å -----
            function nextLevel() {
                if (!gameActive) return;

                level++;
                levelSpan.textContent = level;
                
                playSound('levelUp');

                const squares = gameField.querySelectorAll('.square');
                squares.forEach(sq => sq.remove());

                if (misses >= 3) {
                    endGame();
                    return;
                }

                startLevel();
            }

            // ----- –æ–∫–æ–Ω—á–∞–Ω–∏–µ –∏–≥—Ä—ã -----
            function endGame() {
                if (!gameActive) return;
                gameActive = false;
                updateGameFieldState();

                // –§–∏–Ω–∞–ª—å–Ω—ã–π –∑–≤—É–∫ –ø—Ä–æ–∏–≥—Ä—ã—à–∞ (–æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø—Ä–æ–º–∞—Ö–∞)
                playSound('gameOver');

                if (spawnInterval) clearInterval(spawnInterval);
                if (levelTimer) clearTimeout(levelTimer);

                const squares = gameField.querySelectorAll('.square');
                squares.forEach(sq => sq.remove());

                resultDiv.style.display = "block";
                finalLevelSpan.textContent = level;
                finalScoreSpan.textContent = score;
            }

            // ----- –°–¢–ê–†–¢ –ò–ì–†–´ (–ø–æ –∫–Ω–æ–ø–∫–µ) -----
            function startGame() {
                if (gameActive) return; // –ò–≥—Ä–∞ —É–∂–µ –∏–¥—ë—Ç
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë –¥–æ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
                gameActive = true;
                score = 0;
                misses = 0;
                level = 1;
                interval = baseInterval;

                scoreSpan.textContent = "0";
                missesSpan.textContent = "0";
                levelSpan.textContent = "1";
                updateDifficultyLabel();
                updateGameFieldState();

                const squares = gameField.querySelectorAll('.square');
                squares.forEach(sq => sq.remove());

                resultDiv.style.display = "none";
                
                // –†–∞–∑–±—É–¥–∏—Ç—å –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç
                audioCtx.resume();
                
                startLevel();
            }

            // ----- –ù–û–í–ê–Ø –ò–ì–†–ê (—Å–±—Ä–æ—Å –±–µ–∑ –∑–∞–ø—É—Å–∫–∞) -----
            function resetGame() {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –∏–≥—Ä—É
                gameActive = false;
                updateGameFieldState();
                
                if (spawnInterval) clearInterval(spawnInterval);
                if (levelTimer) clearTimeout(levelTimer);

                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫–∏
                score = 0;
                misses = 0;
                level = 1;
                interval = baseInterval;

                scoreSpan.textContent = "0";
                missesSpan.textContent = "0";
                levelSpan.textContent = "1";
                updateDifficultyLabel();

                const squares = gameField.querySelectorAll('.square');
                squares.forEach(sq => sq.remove());

                resultDiv.style.display = "none";
            }

            // ----- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ -----
            function saveResult() {
                let name = playerNameInput.value.trim();
                if (name === "") name = "–ê–ù–û–ù–ò–ú";

                const canvas = document.createElement("canvas");
                canvas.width = 500;
                canvas.height = 300;
                const ctx = canvas.getContext("2d");

                const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
                grad.addColorStop(0, '#0B0F1C');
                grad.addColorStop(1, '#1A1F33');
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                ctx.strokeStyle = "#6D8CFF";
                ctx.lineWidth = 4;
                ctx.strokeRect(10, 10, canvas.width - 20, canvas.height - 20);

                ctx.font = "bold 32px 'Space Grotesk', 'Arial', sans-serif";
                ctx.fillStyle = "#A7C0FF";
                ctx.shadowColor = '#4F72E0';
                ctx.shadowBlur = 10;
                ctx.fillText("‚ö° REACT ‚ö°", 140, 70);
                ctx.shadowBlur = 0;

                ctx.font = "26px 'Space Grotesk', monospace";
                ctx.fillStyle = "#FFFFFF";
                ctx.shadowColor = '#000';
                ctx.shadowBlur = 8;
                ctx.fillText(`${name}`, 70, 140);
                ctx.shadowBlur = 0;

                ctx.font = "bold 20px 'Space Grotesk'";
                ctx.fillStyle = "#FFD966";
                ctx.fillText(`–£–†–û–í–ï–ù–¨ ${level}`, 70, 190);
                ctx.fillStyle = "#FFB7B7";
                ctx.fillText(`–û–ß–ö–ò ${score}`, 70, 235);

                const now = new Date();
                ctx.font = "16px monospace";
                ctx.fillStyle = "#9BA9DE";
                ctx.fillText(now.toLocaleString(), 70, 280);

                const link = document.createElement("a");
                link.download = `reaction_${name}_lv${level}.jpg`;
                link.href = canvas.toDataURL("image/jpeg", 0.95);
                link.click();
            }

            // ---- –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ ----
            function toggleSound() {
                soundEnabled = !soundEnabled;
                if (soundEnabled) {
                    soundToggle.textContent = "üîä –ó–í–£–ö –í–ö–õ";
                    soundToggle.classList.remove('muted');
                    // –ü—Ä–æ–±–Ω—ã–π –∑–≤—É–∫
                    playSound('click');
                } else {
                    soundToggle.textContent = "üîá –ó–í–£–ö –í–´–ö–õ";
                    soundToggle.classList.add('muted');
                }
            }

            // ---- –ø—Ä–∏–≤—è–∑–∫–∞ –∫–Ω–æ–ø–æ–∫ ----
            saveBtn.onclick = saveResult;
            startBtn.onclick = startGame;
            newGameBtn.onclick = resetGame;
            soundToggle.onclick = toggleSound;

            // ---- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ----
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É –≤ –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–µ–∑ –∑–∞–ø—É—Å–∫–∞
            resetGame();
            
            // –ù–∞–∂–∏–º–∞–µ–º –Ω–∞ –ø–æ–ª–µ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∞—É–¥–∏–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
            gameField.addEventListener('click', () => audioCtx.resume(), { once: true });
            
        })();
    </script>
</body>
</html>