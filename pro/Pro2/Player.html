<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ü–ª–µ–µ—Ä</title>
    <style>
        :root {
            --primary: #8a2be2;
            --primary-dark: #6a1cb0;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --bg-hover: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #b3b3b3;
            --text-muted: #888888;
            --border: #333333;
            --success: #4caf50;
            --danger: #f44336;
            --warning: #ff9800;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        h1 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
        }

        .playlist-section {
            flex: 1;
            background-color: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .player-section {
            flex: 2;
            background-color: var(--bg-card);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .playlist-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        button.secondary {
            background-color: transparent;
            border: 1px solid var(--border);
            color: var(--text-secondary);
        }

        button.secondary:hover {
            background-color: var(--bg-hover);
        }

        button.danger {
            background-color: var(--danger);
        }

        button.danger:hover {
            background-color: #d32f2f;
        }

        button.success {
            background-color: var(--success);
        }

        button.success:hover {
            background-color: #388e3c;
        }

        button.warning {
            background-color: var(--warning);
        }

        button.warning:hover {
            background-color: #f57c00;
        }

        .playlist-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px;
        }

        .playlist-item {
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 8px;
            background-color: var(--bg-dark);
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .playlist-item:hover {
            background-color: var(--bg-hover);
        }

        .playlist-item.active {
            background-color: var(--primary-dark);
        }

        .playlist-item .name {
            font-weight: 500;
        }

        .playlist-item .count {
            color: var(--text-muted);
            font-size: 12px;
        }

        .track-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            border: 1px solid var(--border);
            border-radius: 5px;
            padding: 10px;
        }

        .track-item {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            background-color: var(--bg-dark);
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .track-item:hover {
            background-color: var(--bg-hover);
        }

        .track-item.playing {
            background-color: var(--primary-dark);
        }

        .track-item .track-info {
            flex: 1;
        }

        .track-item .title {
            font-weight: 500;
            margin-bottom: 3px;
        }

        .track-item .artist {
            color: var(--text-muted);
            font-size: 12px;
        }

        .track-item .duration {
            color: var(--text-muted);
            font-size: 12px;
            margin-right: 10px;
        }

        .track-actions {
            display: flex;
            gap: 5px;
        }

        .track-actions button {
            padding: 4px 8px;
            font-size: 12px;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
        }

        .player-controls button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 16px;
        }

        .play-pause {
            width: 50px;
            height: 50px;
            font-size: 20px;
        }

        .progress-container {
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: var(--border);
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress {
            height: 100%;
            background-color: var(--primary);
            border-radius: 3px;
            width: 0%;
        }

        .time-info {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 12px;
            color: var(--text-muted);
        }

        .current-track {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--bg-dark);
            border-radius: 8px;
        }

        .track-title {
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .track-artist {
            color: var(--text-muted);
            font-size: 14px;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }

        .volume-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 4px;
            background: var(--border);
            border-radius: 2px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--primary);
            cursor: pointer;
        }

        .player-mode-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }

        .player-mode-controls button {
            font-size: 12px;
            padding: 6px 12px;
        }

        .player-mode-controls button.active {
            background-color: var(--primary-dark);
            border: 1px solid var(--primary);
        }

        .file-info {
            background-color: var(--bg-dark);
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border: 1px solid var(--border);
        }

        .file-info h4 {
            margin-bottom: 8px;
            color: var(--text-secondary);
        }

        .file-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .file-item {
            padding: 5px;
            font-size: 12px;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .file-item:last-child {
            border-bottom: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
        }

        .modal-title {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border);
            background-color: var(--bg-dark);
            color: var(--text-primary);
            font-size: 14px;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-block;
            padding: 8px 15px;
            background-color: var(--primary);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .file-input-label:hover {
            background-color: var(--primary-dark);
        }

        .empty-state {
            text-align: center;
            color: var(--text-muted);
            padding: 30px 0;
            font-style: italic;
        }

        .add-tracks-btn {
            background-color: var(--success);
        }

        .add-tracks-btn:hover {
            background-color: #388e3c;
        }

        .file-drop-area {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-drop-area:hover {
            border-color: var(--primary);
        }

        .file-drop-area.dragover {
            border-color: var(--primary);
            background-color: var(--bg-hover);
        }

        .file-drop-text {
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .file-drop-hint {
            font-size: 12px;
            color: var(--text-muted);
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .playlist-section, .player-section {
                flex: none;
            }
            
            .playlist-controls {
                flex-direction: column;
            }
            
            button {
                justify-content: center;
            }
            
            .track-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .track-actions {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ú—É–∑—ã–∫–∞–ª—å–Ω—ã–π –ü–ª–µ–µ—Ä</h1>
            <p class="subtitle">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç—ã –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –º—É–∑—ã–∫–æ–π</p>
        </header>
        
        <div class="main-content">
            <div class="playlist-section">
                <div class="section-title">
                    <span>–ü–ª–µ–π–ª–∏—Å—Ç—ã</span>
                    <div>
                        <button id="savePlaylistsBtn" class="secondary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button id="loadPlaylistsBtn" class="secondary">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
                    </div>
                </div>
                
                <div class="playlist-controls">
                    <button id="createPlaylistBtn">üìù –°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</button>
                    <button id="addTracksBtn" class="add-tracks-btn">üéµ –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ)</button>
                    <input type="file" id="fileInput" class="file-input" accept="audio/*" multiple>
                </div>
                
                <div class="playlist-list" id="playlistList">
                    <!-- –ü–ª–µ–π–ª–∏—Å—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
                
                <div class="section-title">
                    <span>–¢—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ</span>
                </div>
                
                <div class="track-list" id="trackList">
                    <!-- –¢—Ä–µ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
            
            <div class="player-section">
                <div class="current-track">
                    <div class="track-title" id="currentTrackTitle">–ù–µ –≤—ã–±—Ä–∞–Ω–æ</div>
                    <div class="track-artist" id="currentTrackArtist">–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">
                        <div class="progress" id="progress"></div>
                    </div>
                    <div class="time-info">
                        <span id="currentTime">0:00</span>
                        <span id="duration">0:00</span>
                    </div>
                </div>
                
                <div class="player-controls">
                    <button id="prevBtn">‚èÆ</button>
                    <button id="playPauseBtn" class="play-pause">‚ñ∂</button>
                    <button id="nextBtn">‚è≠</button>
                </div>

                <div class="player-mode-controls">
                    <button id="shuffleBtn" class="secondary">üîÄ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: –í—ã–∫–ª</button>
                    <button id="repeatBtn" class="secondary">üîÅ –ü–æ–≤—Ç–æ—Ä: –í—ã–∫–ª</button>
                </div>
                
                <div class="volume-control">
                    <span>üîä</span>
                    <input type="range" min="0" max="1" step="0.01" value="0.7" class="volume-slider" id="volumeSlider">
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–µ–π–ª–∏—Å—Ç–∞ -->
    <div class="modal" id="createPlaylistModal">
        <div class="modal-content">
            <div class="modal-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç</div>
            <div class="form-group">
                <label for="playlistName">–ù–∞–∑–≤–∞–Ω–∏–µ –ø–ª–µ–π–ª–∏—Å—Ç–∞</label>
                <input type="text" id="playlistName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
            </div>
            <div class="modal-actions">
                <button id="cancelCreatePlaylist" class="secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmCreatePlaylist">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–µ–∫–æ–≤ -->
    <div class="modal" id="addTracksModal">
        <div class="modal-content">
            <div class="modal-title">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç</div>
            
            <div class="file-drop-area" id="fileDropArea">
                <div class="file-drop-text">üìÅ –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã —Å—é–¥–∞ –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞</div>
                <div class="file-drop-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è MP3, WAV, OGG –∏ –¥—Ä—É–≥–∏–µ –∞—É–¥–∏–æ—Ñ–æ—Ä–º–∞—Ç—ã</div>
                <div class="file-drop-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (Ctrl+Click –∏–ª–∏ Shift+Click)</div>
            </div>
            
            <input type="file" id="modalFileInput" class="file-input" accept="audio/*" multiple>
            
            <div class="file-info" id="fileInfo" style="display: none;">
                <h4>–í—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:</h4>
                <div class="file-list" id="fileList"></div>
            </div>
            
            <div class="modal-actions">
                <button id="cancelAddTracks" class="secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmAddTracks" class="success">–î–æ–±–∞–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ -->
    <div class="modal" id="loadPlaylistsModal">
        <div class="modal-content">
            <div class="modal-title">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç—ã</div>
            <div class="form-group">
                <label for="playlistFile">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª JSON</label>
                <input type="file" id="playlistFile" accept=".json">
            </div>
            <div class="modal-actions">
                <button id="cancelLoadPlaylists" class="secondary">–û—Ç–º–µ–Ω–∞</button>
                <button id="confirmLoadPlaylists">–ó–∞–≥—Ä—É–∑–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let playlists = [];
        let currentPlaylistIndex = -1;
        let currentTrackIndex = -1;
        let audio = new Audio();
        let isPlaying = false;
        let isShuffle = false;
        let isRepeat = false;
        let playedTracks = []; // –î–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤ –≤ —Ä–µ–∂–∏–º–µ shuffle
        let selectedFiles = []; // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const playlistList = document.getElementById('playlistList');
        const trackList = document.getElementById('trackList');
        const createPlaylistBtn = document.getElementById('createPlaylistBtn');
        const addTracksBtn = document.getElementById('addTracksBtn');
        const fileInput = document.getElementById('fileInput');
        const savePlaylistsBtn = document.getElementById('savePlaylistsBtn');
        const loadPlaylistsBtn = document.getElementById('loadPlaylistsBtn');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const repeatBtn = document.getElementById('repeatBtn');
        const progressBar = document.getElementById('progressBar');
        const progress = document.getElementById('progress');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const currentTrackTitle = document.getElementById('currentTrackTitle');
        const currentTrackArtist = document.getElementById('currentTrackArtist');
        const volumeSlider = document.getElementById('volumeSlider');
        
        // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        const createPlaylistModal = document.getElementById('createPlaylistModal');
        const addTracksModal = document.getElementById('addTracksModal');
        const loadPlaylistsModal = document.getElementById('loadPlaylistsModal');
        const playlistNameInput = document.getElementById('playlistName');
        const confirmCreatePlaylist = document.getElementById('confirmCreatePlaylist');
        const cancelCreatePlaylist = document.getElementById('cancelCreatePlaylist');
        const fileDropArea = document.getElementById('fileDropArea');
        const modalFileInput = document.getElementById('modalFileInput');
        const fileInfo = document.getElementById('fileInfo');
        const fileList = document.getElementById('fileList');
        const confirmAddTracks = document.getElementById('confirmAddTracks');
        const cancelAddTracks = document.getElementById('cancelAddTracks');
        const playlistFileInput = document.getElementById('playlistFile');
        const confirmLoadPlaylists = document.getElementById('confirmLoadPlaylists');
        const cancelLoadPlaylists = document.getElementById('cancelLoadPlaylists');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –∏–∑ localStorage –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
            loadPlaylistsFromStorage();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            createPlaylistBtn.addEventListener('click', showCreatePlaylistModal);
            addTracksBtn.addEventListener('click', showAddTracksModal);
            fileInput.addEventListener('change', handleFileSelect);
            savePlaylistsBtn.addEventListener('click', savePlaylistsToFile);
            loadPlaylistsBtn.addEventListener('click', showLoadPlaylistsModal);
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', playPreviousTrack);
            nextBtn.addEventListener('click', playNextTrack);
            shuffleBtn.addEventListener('click', toggleShuffle);
            repeatBtn.addEventListener('click', toggleRepeat);
            progressBar.addEventListener('click', seek);
            volumeSlider.addEventListener('input', setVolume);
            audio.addEventListener('timeupdate', updateProgress);
            audio.addEventListener('loadedmetadata', setDuration);
            audio.addEventListener('ended', handleTrackEnd);
            
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            confirmCreatePlaylist.addEventListener('click', createNewPlaylist);
            cancelCreatePlaylist.addEventListener('click', hideCreatePlaylistModal);
            
            fileDropArea.addEventListener('click', () => modalFileInput.click());
            modalFileInput.addEventListener('change', handleModalFileSelect);
            confirmAddTracks.addEventListener('click', addSelectedFilesToPlaylist);
            cancelAddTracks.addEventListener('click', hideAddTracksModal);
            
            confirmLoadPlaylists.addEventListener('click', loadPlaylistsFromFile);
            cancelLoadPlaylists.addEventListener('click', hideLoadPlaylistsModal);
            
            // Drag and Drop
            setupDragAndDrop();
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
            updatePlaylistList();
            updateTrackList();
            updateModeButtons();
        }
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Drag and Drop
        function setupDragAndDrop() {
            // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –±—Ä–∞—É–∑–µ—Ä–∞
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });
            
            // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –æ–±–ª–∞—Å—Ç–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–∏
            ['dragenter', 'dragover'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                fileDropArea.addEventListener(eventName, unhighlight, false);
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ dropped —Ñ–∞–π–ª–æ–≤
            fileDropArea.addEventListener('drop', handleDrop, false);
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            function highlight() {
                fileDropArea.classList.add('dragover');
            }
            
            function unhighlight() {
                fileDropArea.classList.remove('dragover');
            }
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleDroppedFiles(files);
            }
        }
        
        function handleDroppedFiles(files) {
            selectedFiles = Array.from(files).filter(file => file.type.startsWith('audio/'));
            updateFileList();
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–ª–µ–π–ª–∏—Å—Ç–∞–º–∏
        function showCreatePlaylistModal() {
            playlistNameInput.value = '';
            createPlaylistModal.style.display = 'flex';
        }
        
        function hideCreatePlaylistModal() {
            createPlaylistModal.style.display = 'none';
        }
        
        function showAddTracksModal() {
            if (currentPlaylistIndex === -1) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç');
                return;
            }
            
            selectedFiles = [];
            updateFileList();
            addTracksModal.style.display = 'flex';
        }
        
        function hideAddTracksModal() {
            addTracksModal.style.display = 'none';
            selectedFiles = [];
        }
        
        function createNewPlaylist() {
            const name = playlistNameInput.value.trim();
            if (name) {
                playlists.push({
                    name: name,
                    tracks: []
                });
                hideCreatePlaylistModal();
                updatePlaylistList();
                savePlaylistsToStorage();
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –Ω–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç
                selectPlaylist(playlists.length - 1);
            }
        }
        
        function updatePlaylistList() {
            playlistList.innerHTML = '';
            
            if (playlists.length === 0) {
                playlistList.innerHTML = '<div class="empty-state">–ü–ª–µ–π–ª–∏—Å—Ç—ã –Ω–µ —Å–æ–∑–¥–∞–Ω—ã<br>–ù–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>';
                return;
            }
            
            playlists.forEach((playlist, index) => {
                const playlistItem = document.createElement('div');
                playlistItem.className = `playlist-item ${index === currentPlaylistIndex ? 'active' : ''}`;
                playlistItem.innerHTML = `
                    <div>
                        <div class="name">${playlist.name}</div>
                        <div class="count">${playlist.tracks.length} —Ç—Ä–µ–∫–æ–≤</div>
                    </div>
                    <button class="secondary danger" data-index="${index}">‚úï</button>
                `;
                
                playlistItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('danger')) {
                        selectPlaylist(index);
                    }
                });
                
                const deleteBtn = playlistItem.querySelector('button');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deletePlaylist(index);
                });
                
                playlistList.appendChild(playlistItem);
            });
        }
        
        function selectPlaylist(index) {
            currentPlaylistIndex = index;
            currentTrackIndex = -1;
            playedTracks = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è
            audio.pause();
            isPlaying = false;
            updatePlayPauseButton();
            updatePlaylistList();
            updateTrackList();
            updateCurrentTrackInfo();
        }
        
        function deletePlaylist(index) {
            if (confirm(`–£–¥–∞–ª–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç "${playlists[index].name}"?`)) {
                playlists.splice(index, 1);
                if (currentPlaylistIndex === index) {
                    currentPlaylistIndex = -1;
                    currentTrackIndex = -1;
                    playedTracks = [];
                    audio.pause();
                    isPlaying = false;
                    updatePlayPauseButton();
                    updateCurrentTrackInfo();
                }
                updatePlaylistList();
                updateTrackList();
                savePlaylistsToStorage();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–µ–∫–∞–º–∏
        function handleModalFileSelect(e) {
            const files = Array.from(e.target.files).filter(file => file.type.startsWith('audio/'));
            selectedFiles = selectedFiles.concat(files);
            updateFileList();
            e.target.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ input
        }
        
        function updateFileList() {
            fileList.innerHTML = '';
            
            if (selectedFiles.length === 0) {
                fileInfo.style.display = 'none';
                return;
            }
            
            fileInfo.style.display = 'block';
            
            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    ${index + 1}. ${file.name} 
                    <button class="danger" style="margin-left: 10px; padding: 2px 6px;" onclick="removeFile(${index})">‚úï</button>
                `;
                fileList.appendChild(fileItem);
            });
        }
        
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileList();
        }
        
        function addSelectedFilesToPlaylist() {
            if (selectedFiles.length === 0) {
                alert('–ù–µ –≤—ã–±—Ä–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞');
                return;
            }
            
            let addedCount = 0;
            
            selectedFiles.forEach(file => {
                const url = URL.createObjectURL(file);
                playlists[currentPlaylistIndex].tracks.push({
                    title: file.name.replace(/\.[^/.]+$/, ""), // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
                    artist: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
                    duration: '0:00',
                    url: url,
                    file: file
                });
                addedCount++;
            });
            
            if (addedCount > 0) {
                updateTrackList();
                savePlaylistsToStorage();
                alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —Ç—Ä–µ–∫–æ–≤ –≤ –ø–ª–µ–π–ª–∏—Å—Ç "${playlists[currentPlaylistIndex].name}"`);
                hideAddTracksModal();
            }
        }
        
        function handleFileSelect(e) {
            if (currentPlaylistIndex === -1) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç');
                return;
            }
            
            const files = Array.from(e.target.files).filter(file => file.type.startsWith('audio/'));
            let addedCount = 0;
            
            files.forEach(file => {
                const url = URL.createObjectURL(file);
                playlists[currentPlaylistIndex].tracks.push({
                    title: file.name.replace(/\.[^/.]+$/, ""), // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
                    artist: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å',
                    duration: '0:00',
                    url: url,
                    file: file
                });
                addedCount++;
            });
            
            if (addedCount > 0) {
                updateTrackList();
                savePlaylistsToStorage();
                alert(`–î–æ–±–∞–≤–ª–µ–Ω–æ ${addedCount} —Ç—Ä–µ–∫–æ–≤ –≤ –ø–ª–µ–π–ª–∏—Å—Ç "${playlists[currentPlaylistIndex].name}"`);
            } else {
                alert('–ù–µ –Ω–∞–π–¥–µ–Ω–æ –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è');
            }
            
            e.target.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ input
        }
        
        function updateTrackList() {
            trackList.innerHTML = '';
            
            if (currentPlaylistIndex === -1) {
                trackList.innerHTML = '<div class="empty-state">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–µ–π–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç—Ä–µ–∫–æ–≤</div>';
                return;
            }
            
            if (playlists[currentPlaylistIndex].tracks.length === 0) {
                trackList.innerHTML = '<div class="empty-state">–í –ø–ª–µ–π–ª–∏—Å—Ç–µ –Ω–µ—Ç —Ç—Ä–µ–∫–æ–≤<br>–ù–∞–∂–º–∏—Ç–µ "–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–∫–∏" —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –º—É–∑—ã–∫—É</div>';
                return;
            }
            
            const tracks = playlists[currentPlaylistIndex].tracks;
            tracks.forEach((track, index) => {
                const trackItem = document.createElement('div');
                trackItem.className = `track-item ${index === currentTrackIndex ? 'playing' : ''}`;
                trackItem.innerHTML = `
                    <div class="track-info">
                        <div class="title">${track.title}</div>
                        <div class="artist">${track.artist}</div>
                    </div>
                    <div class="track-actions">
                        <div class="duration">${track.duration}</div>
                        <button class="danger delete-track" data-index="${index}">‚úï</button>
                    </div>
                `;
                
                trackItem.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('delete-track')) {
                        playTrack(index);
                    }
                });
                
                const deleteBtn = trackItem.querySelector('.delete-track');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteTrack(index);
                });
                
                trackList.appendChild(trackItem);
            });
        }
        
        function deleteTrack(index) {
            if (currentPlaylistIndex === -1) return;
            
            const trackName = playlists[currentPlaylistIndex].tracks[index].title;
            if (confirm(`–£–¥–∞–ª–∏—Ç—å —Ç—Ä–µ–∫ "${trackName}" –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞?`)) {
                // –ï—Å–ª–∏ —É–¥–∞–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                if (index === currentTrackIndex) {
                    audio.pause();
                    isPlaying = false;
                    updatePlayPauseButton();
                    currentTrackIndex = -1;
                    updateCurrentTrackInfo();
                } else if (index < currentTrackIndex) {
                    // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ–º –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                    currentTrackIndex--;
                }
                
                // –£–¥–∞–ª—è–µ–º —Ç—Ä–µ–∫ –∏–∑ –ø–ª–µ–π–ª–∏—Å—Ç–∞
                playlists[currentPlaylistIndex].tracks.splice(index, 1);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º playedTracks
                playedTracks = playedTracks.filter(trackIdx => trackIdx !== index);
                playedTracks = playedTracks.map(trackIdx => trackIdx > index ? trackIdx - 1 : trackIdx);
                
                updateTrackList();
                savePlaylistsToStorage();
            }
        }
        
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π...
        function playTrack(index) {
            if (currentPlaylistIndex === -1) return;
            
            const track = playlists[currentPlaylistIndex].tracks[index];
            audio.src = track.url;
            currentTrackIndex = index;
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç—Ä–µ–∫ –≤ –∏—Å—Ç–æ—Ä–∏—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –¥–ª—è —Ä–µ–∂–∏–º–∞ shuffle
            if (isShuffle && !playedTracks.includes(index)) {
                playedTracks.push(index);
            }
            
            audio.play().then(() => {
                isPlaying = true;
                updatePlayPauseButton();
                updateTrackList();
                updateCurrentTrackInfo();
            }).catch(error => {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ñ–∞–π–ª–∞');
            });
        }
        
        function togglePlayPause() {
            if (currentPlaylistIndex === -1 || currentTrackIndex === -1) {
                if (currentPlaylistIndex !== -1 && playlists[currentPlaylistIndex].tracks.length > 0) {
                    // –ï—Å–ª–∏ —Ç—Ä–µ–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω, –Ω–æ –µ—Å—Ç—å —Ç—Ä–µ–∫–∏ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –ø–µ—Ä–≤—ã–π
                    playTrack(0);
                }
                return;
            }
            
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
            } else {
                audio.play();
                isPlaying = true;
            }
            updatePlayPauseButton();
        }
        
        function playPreviousTrack() {
            if (currentPlaylistIndex === -1 || currentTrackIndex === -1) return;
            
            if (isShuffle) {
                // –í —Ä–µ–∂–∏–º–µ shuffle –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Ç—Ä–µ–∫—É –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
                const currentIndexInHistory = playedTracks.indexOf(currentTrackIndex);
                if (currentIndexInHistory > 0) {
                    const prevIndex = playedTracks[currentIndexInHistory - 1];
                    playTrack(prevIndex);
                } else {
                    // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π —Ç—Ä–µ–∫ –≤ –∏—Å—Ç–æ—Ä–∏–∏, –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π
                    playRandomTrack();
                }
            } else {
                // –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º - –ø—Ä–µ–¥—ã–¥—É—â–∏–π –ø–æ –ø–æ—Ä—è–¥–∫—É
                const tracks = playlists[currentPlaylistIndex].tracks;
                let newIndex = currentTrackIndex - 1;
                if (newIndex < 0) {
                    newIndex = tracks.length - 1;
                }
                playTrack(newIndex);
            }
        }
        
        function playNextTrack() {
            if (currentPlaylistIndex === -1 || currentTrackIndex === -1) return;
            
            if (isShuffle) {
                playRandomTrack();
            } else {
                const tracks = playlists[currentPlaylistIndex].tracks;
                let newIndex = currentTrackIndex + 1;
                if (newIndex >= tracks.length) {
                    newIndex = 0;
                }
                playTrack(newIndex);
            }
        }
        
        function playRandomTrack() {
            if (currentPlaylistIndex === -1) return;
            
            const tracks = playlists[currentPlaylistIndex].tracks;
            if (tracks.length === 0) return;
            
            // –ï—Å–ª–∏ –≤—Å–µ —Ç—Ä–µ–∫–∏ —É–∂–µ –±—ã–ª–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω—ã, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é
            if (playedTracks.length >= tracks.length) {
                playedTracks = [];
            }
            
            // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π —Ç—Ä–µ–∫ –∏–∑ —Ç–µ—Ö, —á—Ç–æ –µ—â–µ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–∏—Å—å
            let availableTracks = [];
            for (let i = 0; i < tracks.length; i++) {
                if (!playedTracks.includes(i)) {
                    availableTracks.push(i);
                }
            }
            
            if (availableTracks.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableTracks.length);
                playTrack(availableTracks[randomIndex]);
            } else {
                // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
                const randomIndex = Math.floor(Math.random() * tracks.length);
                playTrack(randomIndex);
            }
        }
        
        function handleTrackEnd() {
            if (isRepeat) {
                // –ü–æ–≤—Ç–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ —Ç—Ä–µ–∫–∞
                audio.currentTime = 0;
                audio.play();
            } else {
                playNextTrack();
            }
        }
        
        function toggleShuffle() {
            isShuffle = !isShuffle;
            playedTracks = []; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏/–≤—ã–∫–ª—é—á–µ–Ω–∏–∏ shuffle
            if (isShuffle && currentTrackIndex !== -1) {
                playedTracks.push(currentTrackIndex); // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π —Ç—Ä–µ–∫ –≤ –∏—Å—Ç–æ—Ä–∏—é
            }
            updateModeButtons();
        }
        
        function toggleRepeat() {
            isRepeat = !isRepeat;
            updateModeButtons();
        }
        
        function updateModeButtons() {
            shuffleBtn.textContent = `üîÄ –°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫: ${isShuffle ? '–í–∫–ª' : '–í—ã–∫–ª'}`;
            shuffleBtn.classList.toggle('active', isShuffle);
            
            repeatBtn.textContent = `üîÅ –ü–æ–≤—Ç–æ—Ä: ${isRepeat ? '–í–∫–ª' : '–í—ã–∫–ª'}`;
            repeatBtn.classList.toggle('active', isRepeat);
        }
        
        function updatePlayPauseButton() {
            playPauseBtn.textContent = isPlaying ? '‚è∏' : '‚ñ∂';
        }
        
        function updateCurrentTrackInfo() {
            if (currentPlaylistIndex === -1 || currentTrackIndex === -1) {
                currentTrackTitle.textContent = '–ù–µ –≤—ã–±—Ä–∞–Ω–æ';
                currentTrackArtist.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç—Ä–µ–∫ –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è';
                return;
            }
            
            const track = playlists[currentPlaylistIndex].tracks[currentTrackIndex];
            currentTrackTitle.textContent = track.title;
            currentTrackArtist.textContent = track.artist;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏ –≤—Ä–µ–º–µ–Ω–µ–º
        function updateProgress() {
            if (audio.duration) {
                const progressPercent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = `${progressPercent}%`;
                
                currentTimeEl.textContent = formatTime(audio.currentTime);
            }
        }
        
        function setDuration() {
            durationEl.textContent = formatTime(audio.duration);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–∫–∞ –≤ –ø–ª–µ–π–ª–∏—Å—Ç–µ
            if (currentPlaylistIndex !== -1 && currentTrackIndex !== -1) {
                playlists[currentPlaylistIndex].tracks[currentTrackIndex].duration = formatTime(audio.duration);
                updateTrackList();
                savePlaylistsToStorage();
            }
        }
        
        function seek(e) {
            if (!audio.duration) return;
            
            const progressBarWidth = progressBar.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            
            audio.currentTime = (clickX / progressBarWidth) * duration;
        }
        
        function setVolume() {
            audio.volume = volumeSlider.value;
        }
        
        function formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${minutes}:${secs < 10 ? '0' : ''}${secs}`;
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤
        function savePlaylistsToStorage() {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ Blob URL)
            const playlistsToSave = playlists.map(playlist => ({
                name: playlist.name,
                tracks: playlist.tracks.map(track => ({
                    title: track.title,
                    artist: track.artist,
                    duration: track.duration
                    // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º URL –∏ —Ñ–∞–π–ª, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ –Ω–µ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã
                }))
            }));
            
            localStorage.setItem('musicPlayerPlaylists', JSON.stringify(playlistsToSave));
        }
        
        function loadPlaylistsFromStorage() {
            const savedPlaylists = localStorage.getItem('musicPlayerPlaylists');
            if (savedPlaylists) {
                try {
                    playlists = JSON.parse(savedPlaylists);
                    updatePlaylistList();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤:', error);
                }
            }
        }
        
        function savePlaylistsToFile() {
            if (playlists.length === 0) {
                alert('–ù–µ—Ç –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ (–±–µ–∑ Blob URL)
            const playlistsToSave = playlists.map(playlist => ({
                name: playlist.name,
                tracks: playlist.tracks.map(track => ({
                    title: track.title,
                    artist: track.artist,
                    duration: track.duration
                }))
            }));
            
            const dataStr = JSON.stringify(playlistsToSave, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'playlists.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('–ü–ª–µ–π–ª–∏—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Ñ–∞–π–ª playlists.json');
        }
        
        function showLoadPlaylistsModal() {
            playlistFileInput.value = '';
            loadPlaylistsModal.style.display = 'flex';
        }
        
        function hideLoadPlaylistsModal() {
            loadPlaylistsModal.style.display = 'none';
        }
        
        function loadPlaylistsFromFile() {
            const file = playlistFileInput.files[0];
            if (!file) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedPlaylists = JSON.parse(e.target.result);
                    playlists = loadedPlaylists;
                    currentPlaylistIndex = -1;
                    currentTrackIndex = -1;
                    playedTracks = [];
                    audio.pause();
                    isPlaying = false;
                    updatePlayPauseButton();
                    updatePlaylistList();
                    updateTrackList();
                    updateCurrentTrackInfo();
                    savePlaylistsToStorage();
                    hideLoadPlaylistsModal();
                    alert('–ü–ª–µ–π–ª–∏—Å—Ç—ã —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
                } catch (error) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON');
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–æ–≤:', error);
                }
            };
            reader.readAsText(file);
        }
        
        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>