<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Файловый менеджер</title>
    <style>
        /* Все предыдущие стили остаются без изменений */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'MS Sans Serif', Arial, sans-serif;
        }
        
        body {
            background-color: #c0c0c0;
            padding: 5px;
            font-size: 14px;
            position: relative;
            min-height: 100vh;
        }
        
        /* Рабочий стол с фоном */
        .desktop-container {
            position: relative;
            border: 2px outset #c0c0c0;
            background-color: #c0c0c0;
            margin-bottom: 5px;
            overflow: hidden;
        }
        
        .desktop-area {
            position: relative;
            height: 400px;
            overflow-y: auto;
            padding: 5px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        /* Темы оформления */
        body.win95 {
            background-color: #c0c0c0;
        }
        
        body.winxp {
            background-color: #ece9d8;
        }
        
        body.win7 {
            background-color: #d6e6ff;
        }
        
        .window {
            border: 2px outset #c0c0c0;
            background-color: #c0c0c0;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }
        
        .winxp .window {
            border: 1px solid #aca899;
            background-color: #ece9d8;
        }
        
        .win7 .window {
            border: 1px solid #a5b4c2;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: white;
            padding: 2px 4px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .winxp .title-bar {
            background: linear-gradient(90deg, #0a246a, #a2b8d0);
        }
        
        .win7 .title-bar {
            background: linear-gradient(90deg, #0050ef, #3a7be0);
            border-radius: 4px 4px 0 0;
        }
        
        .title-bar-controls {
            display: flex;
        }
        
        .title-bar-button {
            width: 16px;
            height: 14px;
            background-color: #c0c0c0;
            border: 1px outset #c0c0c0;
            text-align: center;
            font-size: 10px;
            line-height: 12px;
            margin-left: 2px;
        }
        
        .winxp .title-bar-button {
            background-color: #d4d0c8;
            border: 1px solid #808080;
        }
        
        .win7 .title-bar-button {
            background-color: #e5f3ff;
            border: 1px solid #7a96df;
            border-radius: 3px;
        }
        
        .menu-bar {
            background-color: #c0c0c0;
            border: 1px inset #c0c0c0;
            padding: 2px;
            display: flex;
        }
        
        .winxp .menu-bar {
            background-color: #ece9d8;
            border: none;
        }
        
        .win7 .menu-bar {
            background-color: #f0f0f0;
            border: none;
        }
        
        .menu-item {
            padding: 2px 8px;
            margin-right: 2px;
            position: relative;
        }
        
        .menu-item:hover {
            background-color: #000080;
            color: white;
        }
        
        .winxp .menu-item:hover {
            background-color: #316ac5;
        }
        
        .win7 .menu-item:hover {
            background-color: #c2d6f0;
            color: black;
        }
        
        .menu-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            min-width: 200px;
            z-index: 100;
            display: none;
        }
        
        .winxp .menu-dropdown {
            background-color: #ece9d8;
            border: 1px solid #aca899;
        }
        
        .win7 .menu-dropdown {
            background-color: #f0f0f0;
            border: 1px solid #a5b4c2;
            border-radius: 3px;
        }
        
        .menu-dropdown-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .menu-dropdown-item:hover {
            background-color: #000080;
            color: white;
        }
        
        .winxp .menu-dropdown-item:hover {
            background-color: #316ac5;
        }
        
        .win7 .menu-dropdown-item:hover {
            background-color: #c2d6f0;
            color: black;
        }
        
        .menu-dropdown-separator {
            height: 1px;
            background-color: #808080;
            margin: 2px 0;
        }
        
        .toolbar {
            background-color: #c0c0c0;
            border: 1px inset #c0c0c0;
            padding: 2px;
            display: flex;
            flex-wrap: wrap;
        }
        
        .winxp .toolbar {
            background-color: #ece9d8;
            border: none;
        }
        
        .win7 .toolbar {
            background-color: #f0f0f0;
            border: none;
        }
        
        .button {
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 3px 8px;
            margin-right: 4px;
            font-size: 12px;
            margin-bottom: 2px;
        }
        
        .button:active {
            border: 2px inset #c0c0c0;
        }
        
        .winxp .button {
            background-color: #ece9d8;
            border: 1px solid #aca899;
        }
        
        .win7 .button {
            background-color: #e1e1e1;
            border: 1px solid #adadad;
            border-radius: 3px;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            padding: 2px;
            background-color: #c0c0c0;
            border: 1px inset #c0c0c0;
            flex-wrap: wrap;
        }
        
        .winxp .search-bar {
            background-color: #ece9d8;
            border: none;
        }
        
        .win7 .search-bar {
            background-color: #f0f0f0;
            border: none;
        }
        
        .search-input {
            flex-grow: 1;
            border: 1px inset #c0c0c0;
            padding: 2px;
            background-color: white;
            margin-right: 5px;
            min-width: 150px;
        }
        
        .search-options {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .sort-options {
            display: flex;
            align-items: center;
            padding: 2px;
            background-color: #c0c0c0;
            border: 1px inset #c0c0c0;
            flex-wrap: wrap;
        }
        
        .winxp .sort-options {
            background-color: #ece9d8;
            border: none;
        }
        
        .win7 .sort-options {
            background-color: #f0f0f0;
            border: none;
        }
        
        .sort-select {
            margin-left: 5px;
            border: 1px inset #c0c0c0;
            background-color: white;
            padding: 2px;
        }
        
        .address-bar {
            display: flex;
            align-items: center;
            padding: 2px;
            background-color: #c0c0c0;
        }
        
        .winxp .address-bar {
            background-color: #ece9d8;
        }
        
        .win7 .address-bar {
            background-color: #f0f0f0;
        }
        
        .address-input {
            flex-grow: 1;
            border: 1px inset #c0c0c0;
            padding: 2px;
            background-color: white;
        }
        
        .file-list {
            display: flex;
            flex-wrap: wrap;
        }
        
        .file-item, .folder-item {
            width: 80px;
            margin: 5px;
            text-align: center;
            cursor: pointer;
            padding: 5px;
            position: relative;
        }
        
        .file-item:hover, .folder-item:hover {
            background-color: rgba(0, 0, 128, 0.7);
            color: white;
        }
        
        .winxp .file-item:hover, .winxp .folder-item:hover {
            background-color: rgba(49, 106, 197, 0.7);
        }
        
        .win7 .file-item:hover, .win7 .folder-item:hover {
            background-color: rgba(194, 214, 240, 0.7);
            color: black;
        }
        
        .file-icon, .folder-icon {
            width: 32px;
            height: 32px;
            margin: 0 auto 5px;
            background-size: contain;
            background-repeat: no-repeat;
        }
        
        .folder-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffcc00"><path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>');
        }
        
        .file-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ffffff"><path d="M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6H6zm7 7V3.5L18.5 9H13z"/></svg>');
        }
        
        .text-file-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23008000"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>');
        }
        
        .html-file-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff6600"><path d="M12 17.56l4.07-1.13.55-6.1H9.38L9.2 8.3h7.6l.2-1.99H7l.56 6.01h6.89l-.23 2.58-2.22.6-2.22-.6-.14-1.66h-2l.29 4.19L12 17.56M4.07 3h15.86L18.5 19.2 12 21l-6.5-1.8L4.07 3z"/></svg>');
        }
        
        .image-file-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23008080"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>');
        }
        
        .audio-file-icon {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23800080"><path d="M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"/></svg>');
        }
        
        .file-name {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 12px;
            margin-top: 2px;
            word-break: break-word;
        }
        
        .file-date {
            font-size: 10px;
            color: #ddd;
            margin-top: 2px;
        }
        
        .selected {
            background-color: rgba(0, 0, 128, 0.5) !important;
            border: 1px dashed yellow;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 0;
            width: 90%;
            max-width: 500px;
        }
        
        .winxp .modal-content {
            background-color: #ece9d8;
            border: 1px solid #aca899;
        }
        
        .win7 .modal-content {
            background-color: #f0f0f0;
            border: 1px solid #a5b4c2;
            border-radius: 5px;
        }
        
        .modal-body {
            padding: 10px;
            background-color: white;
        }
        
        .input-field {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
            border: 1px inset #c0c0c0;
        }
        
        .text-editor {
            width: 100%;
            height: 300px;
            border: 1px inset #c0c0c0;
            padding: 5px;
            font-family: monospace;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            display: block;
            margin: 0 auto;
        }
        
        .audio-player {
            width: 100%;
            margin: 10px 0;
        }
        
        .status-bar {
            background-color: #c0c0c0;
            border: 1px inset #c0c0c0;
            padding: 2px;
            display: flex;
            justify-content: space-between;
        }
        
        .winxp .status-bar {
            background-color: #ece9d8;
            border: none;
        }
        
        .win7 .status-bar {
            background-color: #e1e5ee;
            border: none;
        }
        
        .hidden {
            display: none;
        }
        
        .context-menu {
            position: absolute;
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            z-index: 100;
            min-width: 150px;
        }
        
        .winxp .context-menu {
            background-color: #ece9d8;
            border: 1px solid #aca899;
        }
        
        .win7 .context-menu {
            background-color: #f0f0f0;
            border: 1px solid #a5b4c2;
            border-radius: 3px;
        }
        
        .context-menu-item {
            padding: 5px 10px;
            cursor: pointer;
        }
        
        .context-menu-item:hover {
            background-color: #000080;
            color: white;
        }
        
        .winxp .context-menu-item:hover {
            background-color: #316ac5;
        }
        
        .win7 .context-menu-item:hover {
            background-color: #c2d6f0;
            color: black;
        }
        
        .text-documents-list {
            margin-top: 10px;
            border-top: 1px solid #c0c0c0;
            padding-top: 10px;
        }
        
        .text-document-item {
            padding: 5px;
            border: 1px solid #c0c0c0;
            margin-bottom: 5px;
            cursor: pointer;
            position: relative;
        }
        
        .text-document-item:hover {
            background-color: #e0e0e0;
        }
        
        .text-document-preview {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .media-item {
            position: relative;
            margin-bottom: 10px;
            border: 1px solid #c0c0c0;
            padding: 5px;
        }
        
        .delete-media-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #c0c0c0;
            border: 1px outset #c0c0c0;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 18px;
            cursor: pointer;
        }
        
        .delete-media-btn:hover {
            background-color: #ff0000;
            color: white;
        }
        
        .delete-text-doc-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #c0c0c0;
            border: 1px outset #c0c0c0;
            width: 20px;
            height: 20px;
            text-align: center;
            line-height: 18px;
            cursor: pointer;
        }
        
        .delete-text-doc-btn:hover {
            background-color: #ff0000;
            color: white;
        }
        
        .image-viewer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .image-viewer img {
            max-width: 100%;
            max-height: 100%;
        }
        
        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
        }
        
        .image-nav.prev {
            left: 10px;
        }
        
        .image-nav.next {
            right: 10px;
        }
        
        .theme-selector {
            position: absolute;
            top: 30px;
            left: 80px;
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 5px;
            z-index: 10;
        }
        
        .theme-option {
            padding: 5px 10px;
            cursor: pointer;
            margin-bottom: 2px;
        }
        
        .theme-option:hover {
            background-color: #000080;
            color: white;
        }
        
        .theme-option.active {
            background-color: #000080;
            color: white;
        }
        
        /* HTML Preview */
        .html-preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            background-color: white;
        }
        
        .html-preview-container {
            width: 100%;
            height: 100%;
            position: relative;
        }
        
        /* Desktop Background Settings */
        .desktop-settings {
            position: absolute;
            top: 30px;
            left: 150px;
            background-color: #c0c0c0;
            border: 2px outset #c0c0c0;
            padding: 5px;
            z-index: 10;
        }
        
        .desktop-option {
            padding: 5px 10px;
            cursor: pointer;
            margin-bottom: 2px;
        }
        
        .desktop-option:hover {
            background-color: #000080;
            color: white;
        }
        
        /* Новые стили для выбора типа файла */
        .file-type-selector {
            margin: 10px 0;
        }
        
        .file-type-option {
            display: inline-block;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid #c0c0c0;
            cursor: pointer;
        }
        
        .file-type-option.selected {
            background-color: #000080;
            color: white;
        }
        
        .file-extension-hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .help-content {
            padding: 10px;
            line-height: 1.5;
        }
        
        .help-section {
            margin-bottom: 15px;
        }
        
        .help-section h3 {
            margin-bottom: 5px;
            color: #000080;
        }
        
        .share-options {
            margin: 10px 0;
        }
        
        .share-option {
            padding: 8px 12px;
            margin: 5px 0;
            border: 1px solid #c0c0c0;
            cursor: pointer;
            background-color: #e0e0e0;
        }
        
        .share-option:hover {
            background-color: #d0d0d0;
        }
        
        .share-url {
            width: 100%;
            padding: 5px;
            margin: 10px 0;
            border: 1px inset #c0c0c0;
            background-color: white;
        }
        
        .share-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body class="win95">
    <div class="window">
        <div class="title-bar">
            <div class="title-bar-text">Файловый менеджер</div>
            <div class="title-bar-controls">
                <button class="title-bar-button">-</button>
                <button class="title-bar-button">□</button>
                <button class="title-bar-button">×</button>
            </div>
        </div>
        <div class="menu-bar">
            <div class="menu-item" id="file-menu">
                Файл
                <div class="menu-dropdown" id="file-dropdown">
                    <div class="menu-dropdown-item" id="menu-new-folder">Новая папка</div>
                    <div class="menu-dropdown-item" id="menu-new-file">Новый файл</div>
                    <div class="menu-dropdown-separator"></div>
                    <div class="menu-dropdown-item" id="menu-save-system">Сохранить файловую систему</div>
                    <div class="menu-dropdown-item" id="menu-load-system">Загрузить файловую систему</div>
                    <div class="menu-dropdown-separator"></div>
                    <div class="menu-dropdown-item" id="menu-share-system">Поделиться файловой системой</div>
                    <div class="menu-dropdown-item" id="menu-share-folder">Поделиться папкой</div>
                    <div class="menu-dropdown-item" id="menu-share-file">Поделиться файлом</div>
                    <div class="menu-dropdown-separator"></div>
                    <div class="menu-dropdown-item" id="menu-import-share">Импортировать из ссылки</div>
                </div>
            </div>
            <div class="menu-item">Правка</div>
            <div class="menu-item" id="view-menu">Вид</div>
            <div class="menu-item" id="desktop-menu">Рабочий стол</div>
            <div class="menu-item" id="help-menu">Справка</div>
        </div>
        <div class="toolbar">
            <button class="button" id="btn-back">Назад</button>
            <button class="button" id="btn-up">Вверх</button>
            <button class="button" id="btn-new-folder">Новая папка</button>
            <button class="button" id="btn-new-file">Новый файл</button>
            <button class="button" id="btn-copy">Копировать</button>
            <button class="button" id="btn-cut">Вырезать</button>
            <button class="button" id="btn-paste">Вставить</button>
            <button class="button" id="btn-save">Сохранить</button>
            <button class="button" id="btn-load">Загрузить</button>
        </div>
        <div class="search-bar">
            <span>Поиск:</span>
            <input type="text" class="search-input" id="search-input" placeholder="Введите название файла или папки">
            <div class="search-options">
                <label class="checkbox-label">
                    <input type="checkbox" id="deep-search"> Расширенный поиск
                </label>
                <button class="button" id="btn-clear-search" style="margin-left: 10px;">Очистить</button>
            </div>
        </div>
        <div class="sort-options">
            <span>Сортировка:</span>
            <select class="sort-select" id="sort-select">
                <option value="name">По названию</option>
                <option value="date">По дате</option>
                <option value="type">По типу</option>
            </select>
            <select class="sort-select" id="sort-order">
                <option value="asc">По возрастанию</option>
                <option value="desc">По убыванию</option>
            </select>
        </div>
        <div class="address-bar">
            <span>Адрес:</span>
            <input type="text" class="address-input" id="current-path" readonly>
        </div>
        <div class="desktop-container">
            <div class="desktop-area" id="desktop-area">
                <!-- Содержимое файлового менеджера -->
            </div>
        </div>
        <div class="status-bar">
            <div class="status-bar-field" id="clipboard-status">Буфер обмена: пуст</div>
            <div class="status-bar-field" id="file-count">Файлов: 0</div>
        </div>
    </div>

    <!-- Модальное окно для создания папки -->
    <div class="modal hidden" id="folder-modal">
        <div class="modal-content">
            <div class="title-bar">
                <div class="title-bar-text">Новая папка</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-folder-modal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <p>Введите имя папки:</p>
                <input type="text" class="input-field" id="folder-name" placeholder="Имя папки">
                <div style="text-align: right; margin-top: 10px;">
                    <button class="button" id="cancel-folder">Отмена</button>
                    <button class="button" id="create-folder">Создать</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для создания файла -->
    <div class="modal hidden" id="file-modal">
        <div class="modal-content">
            <div class="title-bar">
                <div class="title-bar-text">Новый файл</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-file-modal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <p>Введите имя файла:</p>
                <input type="text" class="input-field" id="file-name" placeholder="Имя файла">
                <div class="file-type-selector">
                    <p>Выберите тип файла:</p>
                    <div class="file-type-option selected" data-type="txt">Текстовый файл (.txt)</div>
                    <div class="file-type-option" data-type="html">HTML документ (.html)</div>
                </div>
                <div class="file-extension-hint">
                    Расширение файла будет добавлено автоматически
                </div>
                <div style="text-align: right; margin-top: 10px;">
                    <button class="button" id="cancel-file">Отмена</button>
                    <button class="button" id="create-file">Создать</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для редактирования файла -->
    <div class="modal hidden" id="editor-modal">
        <div class="modal-content" style="width: 95%; height: 90%;">
            <div class="title-bar">
                <div class="title-bar-text" id="editor-title">Редактор</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-editor-modal">×</button>
                </div>
            </div>
            <div class="toolbar">
                <button class="button" id="btn-save-file">Сохранить</button>
                <button class="button" id="btn-copy-file">Копировать</button>
                <button class="button" id="btn-open-in-editor">Открыть в редакторе</button>
                <button class="button" id="btn-add-image">Добавить изображения</button>
                <button class="button" id="btn-add-audio">Добавить аудио</button>
                <button class="button" id="btn-add-text-doc">Добавить текстовый документ</button>
                <button class="button" id="btn-preview-html" class="hidden">Просмотр HTML</button>
                <button class="button" id="btn-exit-preview" class="hidden">Выйти из просмотра</button>
            </div>
            <div class="modal-body" style="height: calc(100% - 60px); overflow: auto;">
                <textarea class="text-editor" id="file-editor"></textarea>
                <div id="file-content" class="hidden"></div>
                <div id="media-container"></div>
                <div class="text-documents-list" id="text-documents-list"></div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для создания текстового документа -->
    <div class="modal hidden" id="text-doc-modal">
        <div class="modal-content">
            <div class="title-bar">
                <div class="title-bar-text">Новый текстовый документ</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-text-doc-modal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <p>Введите имя документа:</p>
                <input type="text" class="input-field" id="text-doc-name" placeholder="Имя документа">
                <p>Содержимое:</p>
                <textarea class="input-field" id="text-doc-content" placeholder="Введите текст документа" rows="5"></textarea>
                <div style="text-align: right; margin-top: 10px;">
                    <button class="button" id="cancel-text-doc">Отмена</button>
                    <button class="button" id="create-text-doc">Создать</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно просмотра изображения -->
    <div class="modal hidden" id="image-viewer-modal">
        <div class="modal-content" style="width: 95%; height: 95%;">
            <div class="title-bar">
                <div class="title-bar-text" id="image-viewer-title">Просмотр изображения</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-image-viewer-modal">×</button>
                </div>
            </div>
            <div class="modal-body" style="height: calc(100% - 30px); padding: 0; position: relative;">
                <div class="image-viewer" id="image-viewer">
                    <button class="image-nav prev" id="prev-image">‹</button>
                    <img id="viewed-image" src="" alt="Просматриваемое изображение">
                    <button class="image-nav next" id="next-image">›</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно просмотра HTML -->
    <div class="modal hidden" id="html-preview-modal">
        <div class="modal-content" style="width: 95%; height: 95%;">
            <div class="title-bar">
                <div class="title-bar-text" id="html-preview-title">Просмотр HTML</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-html-preview-modal">×</button>
                </div>
            </div>
            <div class="toolbar">
                <button class="button" id="btn-refresh-html">Обновить</button>
                <button class="button" id="btn-open-html-external">Открыть в новой вкладке</button>
            </div>
            <div class="modal-body" style="height: calc(100% - 60px); padding: 0;">
                <div class="html-preview-container">
                    <iframe class="html-preview-frame" id="html-preview-frame" sandbox="allow-scripts allow-forms allow-same-origin"></iframe>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно справки -->
    <div class="modal hidden" id="help-modal">
        <div class="modal-content" style="width: 80%; height: 80%;">
            <div class="title-bar">
                <div class="title-bar-text">Справка - Файловый менеджер</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-help-modal">×</button>
                </div>
            </div>
            <div class="modal-body" style="height: calc(100% - 30px); overflow: auto;">
                <div class="help-content">
                    <div class="help-section">
                        <h3>О программе</h3>
                        <p>Файловый менеджер - это веб-приложение для управления файлами и папками в вашем браузере. 
                        Все данные сохраняются локально в вашем браузере.</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>Основные возможности</h3>
                        <ul>
                            <li><strong>Создание папок и файлов</strong> - используйте кнопки "Новая папка" и "Новый файл"</li>
                            <li><strong>Копирование, вырезание и вставка</strong> - стандартные операции с файлами</li>
                            <li><strong>Поиск файлов</strong> - поиск по имени с возможностью расширенного поиска во всех папках</li>
                            <li><strong>Сортировка</strong> - по имени, дате или типу файла</li>
                            <li><strong>Редактирование файлов</strong> - встроенный текстовый редактор</li>
                            <li><strong>Просмотр изображений</strong> - встроенный просмотрщик с возможностью перелистывания</li>
                            <li><strong>Просмотр HTML</strong> - предпросмотр HTML файлов</li>
                            <li><strong>Добавление медиа</strong> - возможность добавлять изображения и аудио в файлы</li>
                            <li><strong>Текстовые документы</strong> - создание отдельных текстовых документов внутри файлов</li>
                            <li><strong>Сохранение и загрузка</strong> - возможность сохранить файловую систему и загрузить ее позже</li>
                            <li><strong>Поделиться файлами</strong> - возможность поделиться файлами, папками или всей файловой системой</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>Создание файлов</h3>
                        <p>При создании файла выберите тип файла:</p>
                        <ul>
                            <li><strong>Текстовый файл (.txt)</strong> - обычный текстовый файл</li>
                            <li><strong>HTML документ (.html)</strong> - файл с HTML разметкой, который можно просматривать в браузере</li>
                        </ul>
                        <p>Расширение файла добавляется автоматически в зависимости от выбранного типа.</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>Горячие клавиши</h3>
                        <ul>
                            <li><strong>Enter</strong> - создание папки/файла в диалоговых окнах</li>
                            <li><strong>Ctrl+Click</strong> - множественное выделение файлов</li>
                            <li><strong>Правая кнопка мыши</strong> - контекстное меню</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>Темы оформления</h3>
                        <p>Вы можете изменить внешний вид файлового менеджера, выбрав одну из трех тем:</p>
                        <ul>
                            <li><strong>Windows 95</strong> - классический стиль Windows 95</li>
                            <li><strong>Windows XP</strong> - стиль Windows XP</li>
                            <li><strong>Windows 7</strong> - стиль Windows 7</li>
                        </ul>
                    </div>
                    
                    <div class="help-section">
                        <h3>Важно</h3>
                        <p>Все данные хранятся локально в вашем браузере. Для сохранения данных на длительный срок используйте функцию "Сохранить" в меню.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для общего доступа -->
    <div class="modal hidden" id="share-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="title-bar">
                <div class="title-bar-text" id="share-title">Поделиться</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-share-modal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="share-options">
                    <div class="share-option" id="share-system-option">
                        <strong>Поделиться всей файловой системой</strong>
                        <div class="share-info">Создаст ссылку для импорта всей вашей файловой системы</div>
                    </div>
                    <div class="share-option" id="share-folder-option">
                        <strong>Поделиться текущей папкой</strong>
                        <div class="share-info">Создаст ссылку для импорта текущей папки и ее содержимого</div>
                    </div>
                    <div class="share-option" id="share-file-option">
                        <strong>Поделиться выбранным файлом</strong>
                        <div class="share-info">Создаст ссылку для импорта выбранного файла</div>
                    </div>
                </div>
                <div id="share-result" class="hidden">
                    <p>Ссылка для импорта:</p>
                    <input type="text" class="share-url" id="share-url" readonly>
                    <button class="button" id="copy-share-url">Копировать ссылку</button>
                    <div class="share-info">
                        Отправьте эту ссылку другому пользователю. При переходе по ссылке файловая система будет автоматически импортирована.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно для импорта -->
    <div class="modal hidden" id="import-modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="title-bar">
                <div class="title-bar-text">Импорт из ссылки</div>
                <div class="title-bar-controls">
                    <button class="title-bar-button" id="close-import-modal">×</button>
                </div>
            </div>
            <div class="modal-body">
                <p>Введите ссылку для импорта:</p>
                <input type="text" class="input-field" id="import-url" placeholder="https://...">
                <div style="text-align: right; margin-top: 10px;">
                    <button class="button" id="cancel-import">Отмена</button>
                    <button class="button" id="import-data">Импортировать</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Контекстное меню -->
    <div class="context-menu hidden" id="context-menu">
        <div class="context-menu-item" id="context-copy">Копировать</div>
        <div class="context-menu-item" id="context-cut">Вырезать</div>
        <div class="context-menu-item" id="context-paste">Вставить</div>
        <div class="context-menu-item" id="context-rename">Переименовать</div>
        <div class="context-menu-item" id="context-delete">Удалить</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="context-share">Поделиться</div>
    </div>

    <!-- Меню выбора темы -->
    <div class="theme-selector hidden" id="theme-selector">
        <div class="theme-option" data-theme="win95">Windows 95</div>
        <div class="theme-option" data-theme="winxp">Windows XP</div>
        <div class="theme-option" data-theme="win7">Windows 7</div>
    </div>

    <!-- Меню рабочего стола -->
    <div class="desktop-settings hidden" id="desktop-settings">
        <div class="desktop-option" id="set-desktop-bg">Установить фон рабочего стола</div>
        <div class="desktop-option" id="clear-desktop-bg">Убрать фон</div>
    </div>

    <script>
        // Глобальные переменные
        let fileSystem = {
            name: "root",
            type: "folder",
            children: [],
            path: "/"
        };
        
        let currentFolder = fileSystem;
        let selectedItem = null;
        let pathHistory = [];
        let currentHistoryIndex = -1;
        let searchQuery = "";
        let sortBy = "name";
        let sortOrder = "asc";
        let deepSearch = false;
        let currentTheme = "win95";
        let currentImageIndex = 0;
        let currentImages = [];
        let selectedFileType = "txt"; // По умолчанию текстовый файл
        
        // Буфер обмена для операций копирования/вырезания
        let clipboard = {
            items: [],
            operation: null // 'copy' или 'cut'
        };

        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            initializeFileSystem();
            loadTheme();
            loadDesktopBackground();
            renderFileExplorer();
            setupEventListeners();
            updateClipboardStatus();
            
            // Проверяем, есть ли данные для импорта из URL
            checkUrlForImport();
        });

        // Проверка URL на наличие данных для импорта
        function checkUrlForImport() {
            const urlParams = new URLSearchParams(window.location.search);
            const importData = urlParams.get('import');
            
            if (importData) {
                try {
                    const decodedData = decodeURIComponent(importData);
                    const importObject = JSON.parse(decodedData);
                    
                    if (confirm('Обнаружены данные для импорта. Хотите импортировать их в текущую файловую систему?')) {
                        importDataFromObject(importObject);
                        // Очищаем URL от параметров импорта
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                } catch (error) {
                    console.error('Ошибка при импорте данных из URL:', error);
                }
            }
        }

        // Инициализация файловой системы
        function initializeFileSystem() {
            // Создаем несколько примеров для демонстрации
            const examplesFolder = createFolder("Примеры");
            currentFolder.children.push(examplesFolder);
            
            const textFile = createFile("пример.txt", "text");
            textFile.content = "Это пример текстового файла.\nВы можете редактировать этот текст.";
            examplesFolder.children.push(textFile);
            
            const htmlFile = createFile("пример.html", "html");
            htmlFile.content = `<!DOCTYPE html>
<html>
<head>
    <title>Пример HTML</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        button { padding: 10px; margin: 5px; }
        .container { max-width: 600px; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Демонстрация HTML</h1>
        <p>Это пример HTML документа, который можно редактировать и тестировать.</p>
        <button onclick="alert('Привет, мир!')">Нажми меня</button>
        <button onclick="document.getElementById('demo').innerHTML = 'Текст изменен!'">Изменить текст</button>
        <p id="demo">Исходный текст</p>
        <input type="text" id="inputField" placeholder="Введите текст">
        <button onclick="document.getElementById('output').innerHTML = document.getElementById('inputField').value">Показать введенный текст</button>
        <p id="output"></p>
    </div>
</body>
</html>`;
            examplesFolder.children.push(htmlFile);
            
            // Создаем файл справки
            const helpFile = createFile("справка.txt", "text");
            helpFile.content = `ФАЙЛОВЫЙ МЕНЕДЖЕР - СПРАВКА

Основные возможности:
- Создание папок и файлов
- Копирование, вырезание и вставка
- Поиск файлов
- Сортировка по различным параметрам
- Редактирование файлов
- Просмотр изображений и HTML
- Добавление медиафайлов
- Сохранение и загрузка файловой системы
- Поделиться файлами и папками

Для получения подробной информации откройте меню "Справка".`;
            currentFolder.children.push(helpFile);
            
            updateFileCount();
        }

        // Создание объекта папки
        function createFolder(name) {
            return {
                name: name,
                type: "folder",
                children: [],
                path: currentFolder.path + name + "/",
                created: new Date().toLocaleString()
            };
        }

        // Создание объекта файла
        function createFile(name, type) {
            // Добавляем расширение, если его нет
            let fileName = name;
            if (type === "html" && !fileName.endsWith('.html')) {
                fileName += '.html';
            } else if (type === "text" && !fileName.endsWith('.txt')) {
                fileName += '.txt';
            }
            
            return {
                name: fileName,
                type: type,
                content: "",
                path: currentFolder.path + fileName,
                created: new Date().toLocaleString(),
                media: [],
                textDocuments: []
            };
        }

        // Создание объекта текстового документа
        function createTextDocument(name, content = "") {
            return {
                name: name,
                content: content,
                created: new Date().toLocaleString()
            };
        }

        // Отрисовка файлового менеджера
        function renderFileExplorer() {
            const explorer = document.getElementById('desktop-area');
            explorer.innerHTML = '';
            
            // Получаем отфильтрованный и отсортированный список элементов
            let items = getFilteredAndSortedItems();
            
            // Отображаем родительскую папку, если это не корневая
            if (currentFolder !== fileSystem) {
                const parentItem = document.createElement('div');
                parentItem.className = 'folder-item';
                parentItem.innerHTML = `
                    <div class="folder-icon"></div>
                    <div class="file-name">..</div>
                `;
                parentItem.addEventListener('click', function() {
                    navigateToParent();
                });
                explorer.appendChild(parentItem);
            }
            
            // Отображаем папки
            items.filter(item => item.type === 'folder').forEach(folder => {
                const folderItem = document.createElement('div');
                folderItem.className = 'folder-item';
                folderItem.innerHTML = `
                    <div class="folder-icon"></div>
                    <div class="file-name">${folder.name}</div>
                    <div class="file-date">${folder.created}</div>
                `;
                folderItem.addEventListener('click', function(e) {
                    if (e.ctrlKey) {
                        // Выбор нескольких элементов с Ctrl
                        folderItem.classList.toggle('selected');
                    } else {
                        // Одиночный выбор
                        clearSelection();
                        folderItem.classList.add('selected');
                        navigateToFolder(folder);
                    }
                });
                folderItem.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    clearSelection();
                    folderItem.classList.add('selected');
                    showContextMenu(e, folder);
                });
                explorer.appendChild(folderItem);
            });
            
            // Отображаем файлы
            items.filter(item => item.type !== 'folder').forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                let iconClass = 'file-icon';
                if (file.name.endsWith('.txt')) {
                    iconClass = 'text-file-icon';
                } else if (file.name.endsWith('.html')) {
                    iconClass = 'html-file-icon';
                } else if (file.name.endsWith('.jpg') || file.name.endsWith('.png') || file.name.endsWith('.gif')) {
                    iconClass = 'image-file-icon';
                } else if (file.name.endsWith('.mp3') || file.name.endsWith('.wav')) {
                    iconClass = 'audio-file-icon';
                }
                
                fileItem.innerHTML = `
                    <div class="${iconClass}"></div>
                    <div class="file-name">${file.name}</div>
                    <div class="file-date">${file.created}</div>
                `;
                fileItem.addEventListener('click', function(e) {
                    if (e.ctrlKey) {
                        // Выбор нескольких элементов с Ctrl
                        fileItem.classList.toggle('selected');
                    } else {
                        // Одиночный выбор
                        clearSelection();
                        fileItem.classList.add('selected');
                        openFile(file);
                    }
                });
                fileItem.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    clearSelection();
                    fileItem.classList.add('selected');
                    showContextMenu(e, file);
                });
                explorer.appendChild(fileItem);
            });
            
            // Обновляем путь в адресной строке
            document.getElementById('current-path').value = currentFolder.path;
        }

        // Очистка выделения
        function clearSelection() {
            document.querySelectorAll('.file-item.selected, .folder-item.selected').forEach(item => {
                item.classList.remove('selected');
            });
        }

        // Получение отфильтрованного и отсортированного списка элементов
        function getFilteredAndSortedItems() {
            let items = [];
            
            // Если включен расширенный поиск, ищем во всей файловой системе
            if (deepSearch && searchQuery) {
                items = searchInFileSystem(fileSystem, searchQuery.toLowerCase());
            } else {
                // Иначе работаем только с текущей папке
                items = [...currentFolder.children];
                
                // Применяем фильтрацию по поисковому запросу
                if (searchQuery) {
                    const query = searchQuery.toLowerCase();
                    items = items.filter(item => 
                        item.name.toLowerCase().includes(query)
                    );
                }
            }
            
            // Применяем сортировку
            items.sort((a, b) => {
                let aValue, bValue;
                
                if (sortBy === 'name') {
                    aValue = a.name.toLowerCase();
                    bValue = b.name.toLowerCase();
                } else if (sortBy === 'date') {
                    aValue = new Date(a.created);
                    bValue = new Date(b.created);
                } else if (sortBy === 'type') {
                    aValue = a.type === 'folder' ? 0 : 1;
                    bValue = b.type === 'folder' ? 0 : 1;
                }
                
                if (aValue < bValue) return sortOrder === 'asc' ? -1 : 1;
                if (aValue > bValue) return sortOrder === 'asc' ? 1 : -1;
                return 0;
            });
            
            return items;
        }

        // Рекурсивный поиск во всей файловой системе
        function searchInFileSystem(folder, query) {
            let results = [];
            
            for (let item of folder.children) {
                if (item.name.toLowerCase().includes(query)) {
                    results.push(item);
                }
                
                if (item.type === 'folder') {
                    results = results.concat(searchInFileSystem(item, query));
                }
            }
            
            return results;
        }

        // Навигация в папку
        function navigateToFolder(folder) {
            pathHistory = pathHistory.slice(0, currentHistoryIndex + 1);
            pathHistory.push(currentFolder);
            currentHistoryIndex++;
            currentFolder = folder;
            renderFileExplorer();
        }

        // Навигация к родительской папке
        function navigateToParent() {
            if (currentFolder === fileSystem) return;
            
            let parent = findParent(fileSystem, currentFolder);
            if (parent) {
                pathHistory = pathHistory.slice(0, currentHistoryIndex + 1);
                pathHistory.push(currentFolder);
                currentHistoryIndex++;
                currentFolder = parent;
                renderFileExplorer();
            }
        }

        // Поиск родительской папки
        function findParent(root, folder) {
            if (root.children.includes(folder)) {
                return root;
            }
            
            for (let child of root.children) {
                if (child.type === 'folder') {
                    const result = findParent(child, folder);
                    if (result) return result;
                }
            }
            
            return null;
        }

        // Функции для общего доступа
        function shareFileSystem() {
            const dataToShare = {
                type: 'full_system',
                data: fileSystem,
                timestamp: new Date().toISOString()
            };
            
            generateShareLink(dataToShare, 'Файловая система');
        }

        function shareCurrentFolder() {
            const dataToShare = {
                type: 'folder',
                data: currentFolder,
                timestamp: new Date().toISOString()
            };
            
            generateShareLink(dataToShare, `Папка "${currentFolder.name}"`);
        }

        function shareSelectedFile() {
            if (!selectedItem || selectedItem.type === 'folder') {
                alert('Пожалуйста, выберите файл для общего доступа');
                return;
            }
            
            const dataToShare = {
                type: 'file',
                data: selectedItem,
                timestamp: new Date().toISOString()
            };
            
            generateShareLink(dataToShare, `Файл "${selectedItem.name}"`);
        }

        function generateShareLink(data, title) {
            const jsonString = JSON.stringify(data);
            const encodedData = encodeURIComponent(jsonString);
            const shareUrl = `${window.location.origin}${window.location.pathname}?import=${encodedData}`;
            
            document.getElementById('share-title').textContent = `Поделиться: ${title}`;
            document.getElementById('share-url').value = shareUrl;
            document.getElementById('share-result').classList.remove('hidden');
        }

        function importDataFromObject(importObject) {
            if (!importObject || !importObject.type || !importObject.data) {
                alert('Некорректные данные для импорта');
                return;
            }
            
            try {
                if (importObject.type === 'full_system') {
                    if (confirm('Заменить текущую файловую систему импортируемой?')) {
                        fileSystem = importObject.data;
                        currentFolder = fileSystem;
                        pathHistory = [];
                        currentHistoryIndex = -1;
                        renderFileExplorer();
                        alert('Файловая система успешно импортирована!');
                    }
                } else if (importObject.type === 'folder') {
                    const importedFolder = importObject.data;
                    importedFolder.name = findUniqueName(importedFolder.name);
                    currentFolder.children.push(importedFolder);
                    renderFileExplorer();
                    alert(`Папка "${importedFolder.name}" успешно импортирована!`);
                } else if (importObject.type === 'file') {
                    const importedFile = importObject.data;
                    importedFile.name = findUniqueName(importedFile.name);
                    currentFolder.children.push(importedFile);
                    renderFileExplorer();
                    alert(`Файл "${importedFile.name}" успешно импортирован!`);
                }
                
                autoSave();
            } catch (error) {
                alert('Ошибка при импорте данных: ' + error.message);
            }
        }

        function importFromUrl() {
            const url = document.getElementById('import-url').value.trim();
            if (!url) {
                alert('Введите URL для импорта');
                return;
            }
            
            try {
                const urlObj = new URL(url);
                const importParam = urlObj.searchParams.get('import');
                
                if (!importParam) {
                    alert('URL не содержит данных для импорта');
                    return;
                }
                
                const decodedData = decodeURIComponent(importParam);
                const importObject = JSON.parse(decodedData);
                
                importDataFromObject(importObject);
                document.getElementById('import-modal').classList.add('hidden');
                document.getElementById('import-url').value = '';
            } catch (error) {
                alert('Ошибка при импорте из URL: ' + error.message);
            }
        }

        // Остальные функции остаются без изменений (copyItems, cutItems, pasteItems, openFile, и т.д.)
        // ... (все остальные функции из предыдущего кода)

        // Настройка обработчиков событий
        function setupEventListeners() {
            // Меню "Файл"
            document.getElementById('file-menu').addEventListener('click', function(e) {
                const dropdown = document.getElementById('file-dropdown');
                dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
                e.stopPropagation();
            });
            
            // Закрытие dropdown при клике вне его
            document.addEventListener('click', function() {
                document.getElementById('file-dropdown').style.display = 'none';
                document.getElementById('theme-selector').classList.add('hidden');
                document.getElementById('desktop-settings').classList.add('hidden');
            });
            
            // Пункты меню "Файл"
            document.getElementById('menu-new-folder').addEventListener('click', function() {
                document.getElementById('folder-modal').classList.remove('hidden');
                document.getElementById('folder-name').focus();
            });
            
            document.getElementById('menu-new-file').addEventListener('click', function() {
                document.getElementById('file-modal').classList.remove('hidden');
                document.getElementById('file-name').focus();
            });
            
            document.getElementById('menu-save-system').addEventListener('click', saveFileSystem);
            document.getElementById('menu-load-system').addEventListener('click', loadFileSystem);
            
            document.getElementById('menu-share-system').addEventListener('click', function() {
                document.getElementById('share-modal').classList.remove('hidden');
                document.getElementById('share-result').classList.add('hidden');
            });
            
            document.getElementById('menu-share-folder').addEventListener('click', shareCurrentFolder);
            document.getElementById('menu-share-file').addEventListener('click', shareSelectedFile);
            
            document.getElementById('menu-import-share').addEventListener('click', function() {
                document.getElementById('import-modal').classList.remove('hidden');
                document.getElementById('import-url').focus();
            });
            
            // Обработчики для модального окна общего доступа
            document.getElementById('share-system-option').addEventListener('click', shareFileSystem);
            document.getElementById('share-folder-option').addEventListener('click', shareCurrentFolder);
            document.getElementById('share-file-option').addEventListener('click', shareSelectedFile);
            
            document.getElementById('copy-share-url').addEventListener('click', function() {
                const urlInput = document.getElementById('share-url');
                urlInput.select();
                document.execCommand('copy');
                alert('Ссылка скопирована в буфер обмена!');
            });
            
            document.getElementById('close-share-modal').addEventListener('click', function() {
                document.getElementById('share-modal').classList.add('hidden');
            });
            
            // Обработчики для модального окна импорта
            document.getElementById('close-import-modal').addEventListener('click', function() {
                document.getElementById('import-modal').classList.add('hidden');
            });
            
            document.getElementById('cancel-import').addEventListener('click', function() {
                document.getElementById('import-modal').classList.add('hidden');
            });
            
            document.getElementById('import-data').addEventListener('click', importFromUrl);
            
            // Остальные обработчики событий...
            // ... (все остальные обработчики из предыдущего кода)
            
            // Добавляем пункт "Поделиться" в контекстное меню
            document.getElementById('context-share').addEventListener('click', function() {
                if (selectedItem) {
                    if (selectedItem.type === 'folder') {
                        // Для временного использования - переходим в папку и делимся ей
                        const originalFolder = currentFolder;
                        currentFolder = selectedItem;
                        shareCurrentFolder();
                        currentFolder = originalFolder;
                    } else {
                        shareSelectedFile();
                    }
                }
                closeContextMenu();
            });
        }

        // Остальной код без изменений...
    </script>
</body>
</html>